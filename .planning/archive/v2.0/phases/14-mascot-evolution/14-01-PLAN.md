---
phase: 14-mascot-evolution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/services/mastery.ts
  - medtriad/components/home/TriMascot.tsx
  - medtriad/components/home/HeroCard.tsx
autonomous: true
user_setup:
  - service: user-assets
    why: "6 tier-specific mascot PNG images"
    action:
      - task: "Provide tri-tier-1.png through tri-tier-6.png"
        location: "medtriad/assets/images/"
        details: "Pre-composed mascot images with accessories for each tier (Student=none, Intern=bandaid, Resident=clipboard, Doctor=stethoscope, Specialist=head mirror, Chief=gold badge)"

must_haves:
  truths:
    - "Home screen mascot displays tier-specific image based on user's current tier"
    - "checkTierUp helper correctly identifies tier boundaries"
    - "TriMascot component accepts tier prop for home context"
  artifacts:
    - path: "medtriad/services/mastery.ts"
      provides: "checkTierUp function"
      exports: ["checkTierUp"]
    - path: "medtriad/components/home/TriMascot.tsx"
      provides: "Tier-based image selection for home context"
      contains: "TIER_IMAGES"
    - path: "medtriad/components/home/HeroCard.tsx"
      provides: "Passes tier to TriMascot"
      contains: "tier={tier}"
  key_links:
    - from: "medtriad/components/home/HeroCard.tsx"
      to: "medtriad/components/home/TriMascot.tsx"
      via: "tier prop"
      pattern: "tier=\\{tier\\}"
    - from: "medtriad/components/home/TriMascot.tsx"
      to: "TIER_IMAGES"
      via: "getImageSource function"
      pattern: "TIER_IMAGES\\[tier"
---

<objective>
Add tier-based mascot image selection so Home screen displays the mascot with accessories matching the user's current tier.

Purpose: Foundation for mascot evolution - mascot appearance reflects progression tier
Output: TriMascot displays tier-specific image on Home, checkTierUp helper ready for celebration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-mascot-evolution/14-RESEARCH.md
@.planning/phases/14-mascot-evolution/14-CONTEXT.md
@medtriad/services/mastery.ts
@medtriad/components/home/TriMascot.tsx
@medtriad/components/home/HeroCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add checkTierUp helper to mastery.ts</name>
  <files>medtriad/services/mastery.ts</files>
  <action>
Add a checkTierUp function that determines if completing a game will cause a tier-up:

```typescript
/**
 * Check if completing the next game will trigger a tier-up
 * Call BEFORE incrementing gamesPlayed to avoid race condition
 * @param gamesPlayedBefore - Current gamesPlayed count (before this game)
 * @returns Object with willTierUp flag and newTier if applicable
 */
export function checkTierUp(
  gamesPlayedBefore: number
): { willTierUp: boolean; newTier: TierDefinition | null } {
  const gamesPlayedAfter = gamesPlayedBefore + 1;
  const tierBefore = getTierForGames(gamesPlayedBefore);
  const tierAfter = getTierForGames(gamesPlayedAfter);

  return {
    willTierUp: tierAfter.tier > tierBefore.tier,
    newTier: tierAfter.tier > tierBefore.tier ? tierAfter : null,
  };
}
```

Add this export alongside existing tier functions. This function is called before recordQuizResult to capture the tier boundary crossing.
  </action>
  <verify>TypeScript compiles without errors. Function is exported from mastery.ts.</verify>
  <done>checkTierUp function exists and correctly identifies tier boundaries (e.g., checkTierUp(9) returns willTierUp: true for crossing into Intern at 10 games).</done>
</task>

<task type="auto">
  <name>Task 2: Add tier-based image selection to TriMascot</name>
  <files>medtriad/components/home/TriMascot.tsx</files>
  <action>
1. Add static TIER_IMAGES object at module level (Metro bundler requires static requires):

```typescript
// Tier-specific mascot images (static requires for Metro bundler)
const TIER_IMAGES = {
  1: require('@/assets/images/tri-tier-1.png'),
  2: require('@/assets/images/tri-tier-2.png'),
  3: require('@/assets/images/tri-tier-3.png'),
  4: require('@/assets/images/tri-tier-4.png'),
  5: require('@/assets/images/tri-tier-5.png'),
  6: require('@/assets/images/tri-tier-6.png'),
} as const;
```

2. Update TriMascotProps to add tier and context props:

```typescript
type TriMascotProps = {
  mood?: MascotMood;
  size?: MascotSize;
  animate?: boolean;
  masteryLevel?: number;  // Keep for backward compat
  tier?: number;          // New: 1-6 tier number
  context?: 'home' | 'quiz' | 'results';  // New: determines image selection logic
};
```

3. Update getImageSource to use tier-based selection for home context:

```typescript
const getImageSource = () => {
  // Home screen uses tier-specific images
  if (context === 'home' && tier) {
    return TIER_IMAGES[tier as keyof typeof TIER_IMAGES] || TIER_IMAGES[1];
  }
  // Quiz/results continue using mood-based images (existing behavior)
  if (masteryLevel >= 10) return triSupermaster;
  if (masteryLevel >= 7) return triMaster;
  if (mood === 'happy' || mood === 'streak') return triHappy;
  return triNeutral;
};
```

Note: The tier images won't exist yet. The app will fall back gracefully to existing images until user provides tri-tier-1.png through tri-tier-6.png. Consider adding a fallback in the component:

```typescript
// Fallback if tier image not yet provided
const tierImage = TIER_IMAGES[tier as keyof typeof TIER_IMAGES];
if (context === 'home' && tier && tierImage) {
  return tierImage;
}
```

Actually, since require() will fail at bundle time if file doesn't exist, wrap in try-catch or use Image.resolveAssetSource to check. Simpler: just let TypeScript validate and document that user must provide assets.
  </action>
  <verify>TypeScript compiles. TriMascot accepts tier and context props.</verify>
  <done>TriMascot shows tier-specific image when context='home' and tier is provided. Falls back to mood-based selection for other contexts.</done>
</task>

<task type="auto">
  <name>Task 3: Update HeroCard to pass tier context to TriMascot</name>
  <files>medtriad/components/home/HeroCard.tsx</files>
  <action>
Update the TriMascot usage in HeroCard to pass tier and context props:

1. HeroCard already receives `tier: TierDefinition` as a prop

2. Update the TriMascot call in the mascotContainer:

```typescript
<TriMascot
  mood={mascotMood}
  size="lg"
  masteryLevel={masteryLevel}
  tier={tier.tier}      // Add tier number from TierDefinition
  context="home"        // Add context for home screen
/>
```

This tells TriMascot to use tier-specific images rather than mood-based selection.
  </action>
  <verify>TypeScript compiles. HeroCard passes tier and context to TriMascot.</verify>
  <done>Home screen HeroCard displays mascot using tier-specific image selection based on user's current tier.</done>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` - no TypeScript errors
2. Run app on simulator - Home screen shows mascot (will use fallback until tier images provided)
3. Verify checkTierUp logic: checkTierUp(9) should return {willTierUp: true, newTier: {tier: 2, name: 'Intern', ...}}
</verification>

<success_criteria>
- checkTierUp function exported from mastery.ts
- TriMascot accepts tier (number) and context ('home' | 'quiz' | 'results') props
- TIER_IMAGES object defined with static requires for tiers 1-6
- HeroCard passes tier.tier and context="home" to TriMascot
- Home screen mascot will display tier-specific image once assets are provided
</success_criteria>

<output>
After completion, create `.planning/phases/14-mascot-evolution/14-01-SUMMARY.md`
</output>
