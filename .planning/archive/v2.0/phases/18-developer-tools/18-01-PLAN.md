---
phase: 18-developer-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/services/dev-tools.ts
  - medtriad/components/settings/DevSection.tsx
  - medtriad/app/(tabs)/settings.tsx
autonomous: true

must_haves:
  truths:
    - "Dev menu visible in __DEV__ mode only"
    - "User can reset onboarding state (sets gamesPlayed to 0)"
    - "User can set tier to any of the 6 levels"
    - "User can clear all app data with confirmation"
    - "User can simulate tier-up celebration"
  artifacts:
    - path: "medtriad/services/dev-tools.ts"
      provides: "Storage manipulation functions for dev testing"
      exports: ["resetOnboarding", "setUserTier", "clearAllData", "setPendingTierUp"]
    - path: "medtriad/components/settings/DevSection.tsx"
      provides: "Dev menu section component"
      exports: ["DevSection"]
    - path: "medtriad/app/(tabs)/settings.tsx"
      provides: "Settings screen with conditional dev section"
      contains: "__DEV__ && <DevSection"
  key_links:
    - from: "medtriad/components/settings/DevSection.tsx"
      to: "medtriad/services/dev-tools.ts"
      via: "import functions"
      pattern: "import.*from.*dev-tools"
    - from: "medtriad/app/(tabs)/settings.tsx"
      to: "medtriad/components/settings/DevSection.tsx"
      via: "conditional render"
      pattern: "__DEV__.*DevSection"
---

<objective>
Add developer tools menu to Settings screen for testing onboarding, tier states, and data clearing.

Purpose: Enable efficient debugging and testing without reinstalling the app. The dev menu only appears in development builds (__DEV__), never in production.

Output: Dev tools service with 4 manipulation functions, DevSection component with 4 menu items, Settings integration with conditional rendering.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-developer-tools/18-RESEARCH.md

@medtriad/services/stats-storage.ts
@medtriad/services/settings-storage.ts
@medtriad/services/mastery.ts
@medtriad/hooks/useStats.ts
@medtriad/components/settings/SettingsRow.tsx
@medtriad/app/(tabs)/settings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dev-tools service</name>
  <files>medtriad/services/dev-tools.ts</files>
  <action>
Create dev-tools.ts service with these functions:

**Storage keys (import from existing files or define):**
- STATS_KEY = '@medtriad_stats'
- HISTORY_KEY = '@medtriad_quiz_history'
- SETTINGS_KEY = '@medtriad_settings'
- ALL_APP_KEYS array combining all three

**Functions:**

1. `resetOnboarding(): Promise<void>`
   - Load current stats from AsyncStorage
   - Set gamesPlayed to 0 and totalPoints to 0
   - Preserve other stats (totalAnswered, bestStreak, etc.)
   - Save back to storage

2. `setUserTier(tierNumber: number): Promise<void>`
   - Validate tierNumber is 1-6 using TIERS from mastery.ts
   - Find tier by number, throw if invalid
   - Load current stats, set totalPoints to tier.pointsRequired + 50
   - Ensure gamesPlayed >= 1 (so not treated as new user)
   - Save back to storage

3. `setPendingTierUp(tier: number, name: string): Promise<void>`
   - Load current stats
   - Set pendingTierUp: { tier, name }
   - Ensure gamesPlayed >= 1
   - Save back to storage

4. `clearAllData(): Promise<void>`
   - Use AsyncStorage.multiRemove([...ALL_APP_KEYS])
   - NOT AsyncStorage.clear() which clears ALL apps

Import TIERS from './mastery' for tier validation. Export all functions.
  </action>
  <verify>TypeScript compiles: `cd medtriad && npx tsc --noEmit`</verify>
  <done>dev-tools.ts exports 4 functions: resetOnboarding, setUserTier, setPendingTierUp, clearAllData</done>
</task>

<task type="auto">
  <name>Task 2: Create DevSection component</name>
  <files>medtriad/components/settings/DevSection.tsx</files>
  <action>
Create DevSection.tsx component following existing Settings section patterns.

**Props:**
- onRefresh: () => Promise<void> - callback to refresh stats after storage changes

**Structure:**
- Section header row with "DEVELOPER" label (use colors.error for red warning color)
- Section card with 4 SettingsRow items and separators

**Menu items (use existing SettingsRow component):**

1. "Reset Onboarding" (icon: "arrow.counterclockwise")
   - Alert: "Reset Onboarding" / "This will reset gamesPlayed to 0. App will show onboarding on next launch."
   - Buttons: Cancel, Reset (destructive)
   - On confirm: call resetOnboarding(), onRefresh(), show "Done" alert

2. "Set User Tier" (icon: "person.badge.plus")
   - Alert: "Set Tier" / "Choose a tier level:"
   - Buttons: One button per tier "1. Student", "2. Intern", etc. + Cancel
   - Map TIERS to alert buttons
   - On select: call setUserTier(tier.tier), onRefresh(), show "Done" alert with tier name

3. "Simulate Tier Up" (icon: "star.fill")
   - Alert: "Simulate Tier Up" / "Set a pending tier-up celebration:"
   - Buttons: TIERS.slice(1) (skip Student - can't tier UP to Student) + Cancel
   - On select: call setPendingTierUp(tier.tier, tier.name), onRefresh(), show "Done" alert

4. "Clear All Data" (icon: "trash.fill", destructive: true)
   - Alert: "Clear All Data" / "This will delete ALL app data. You will need to restart the app."
   - Buttons: Cancel, "Clear Everything" (destructive)
   - On confirm: call clearAllData(), show "Done" alert

**Styling:**
- Copy sectionHeaderRow, sectionHeaderText, sectionHeaderLine styles from settings.tsx
- Use colors.error for header text and line (red warning)
- Use existing section card styling (backgroundCard, border, overflow hidden)
- FadeInUp animation with delay(Durations.stagger * 4) for 5th section
  </action>
  <verify>TypeScript compiles: `cd medtriad && npx tsc --noEmit`</verify>
  <done>DevSection.tsx renders 4 menu items with Alert confirmations</done>
</task>

<task type="auto">
  <name>Task 3: Integrate DevSection into Settings</name>
  <files>medtriad/app/(tabs)/settings.tsx</files>
  <action>
Modify settings.tsx to conditionally render DevSection:

**Imports:**
Add: `import { DevSection } from '@/components/settings/DevSection';`

**Get refresh function:**
Add to component: `const { refresh: refreshStats } = useStats();`
Add import: `import { useStats } from '@/hooks/useStats';`

**Render (at end of ScrollView, after ABOUT section):**
```tsx
{__DEV__ && (
  <DevSection onRefresh={refreshStats} />
)}
```

The `__DEV__` global is provided by Metro bundler - no import needed. It's true in dev, false in production, and the entire DevSection code is tree-shaken from production builds.
  </action>
  <verify>
1. Start dev server: `cd medtriad && npx expo start`
2. Open app in simulator
3. Go to Settings tab
4. Verify DEVELOPER section appears at bottom (red header)
5. Test "Set User Tier" - pick a tier, verify alert shows
  </verify>
  <done>Settings screen shows DEVELOPER section in dev mode only</done>
</task>

</tasks>

<verification>
After all tasks:
1. `cd medtriad && npx tsc --noEmit` - no TypeScript errors
2. Open app in dev mode - DEVELOPER section visible in Settings
3. Test "Reset Onboarding" - gamesPlayed becomes 0 (verify by checking Progress tab shows Student tier)
4. Test "Set User Tier" to Chief - Progress tab shows Chief tier
5. Test "Simulate Tier Up" - go to Home, should see tier-up glow effect
6. Test "Clear All Data" - restart app, should show onboarding

**Production verification (optional):**
Run `npx expo start --no-dev` - DEVELOPER section should NOT appear
</verification>

<success_criteria>
- Dev menu only visible when __DEV__ is true
- All 4 dev actions work with confirmation dialogs
- Storage manipulation actually changes app state
- No TypeScript errors
- Existing Settings functionality unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/18-developer-tools/18-01-SUMMARY.md`
</output>
