---
phase: 11-level-system
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - medtriad/app/(tabs)/progress.tsx
  - medtriad/app/quiz/results.tsx
autonomous: true

must_haves:
  truths:
    - "Progress screen shows current tier name at top"
    - "Progress screen shows thin progress bar toward next tier"
    - "Results screen shows current tier name after quiz"
    - "At max tier (Chief), progress bar shows as full"
  artifacts:
    - path: "medtriad/app/(tabs)/progress.tsx"
      provides: "Tier header with name and progress bar"
      contains: "TierProgressBar"
    - path: "medtriad/app/quiz/results.tsx"
      provides: "Tier name display in mastery badge"
      contains: "tier.name"
  key_links:
    - from: "medtriad/app/(tabs)/progress.tsx"
      to: "medtriad/hooks/useStats.ts"
      via: "useStats hook"
      pattern: "useStats.*tier"
    - from: "medtriad/app/(tabs)/progress.tsx"
      to: "medtriad/components/progress/TierProgressBar.tsx"
      via: "component import"
      pattern: "TierProgressBar"
    - from: "medtriad/app/quiz/results.tsx"
      to: "medtriad/hooks/useStats.ts"
      via: "useStats hook for tier"
      pattern: "tier\\.name"
---

<objective>
Integrate the tier system into the Progress and Results screens.

Purpose: Make tier progression visible to users where it matters most - after completing a quiz and when reviewing their progress.
Output: Progress screen has tier header section; Results screen shows tier name.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-level-system/11-CONTEXT.md
@.planning/phases/11-level-system/11-01-SUMMARY.md

@medtriad/app/(tabs)/progress.tsx
@medtriad/app/quiz/results.tsx
@medtriad/components/progress/TierProgressBar.tsx
@medtriad/hooks/useStats.ts
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tier header to Progress screen</name>
  <files>medtriad/app/(tabs)/progress.tsx</files>
  <action>
Add a tier header section at the top of the Progress screen, below the title and before "YOUR STATS".

Import:
- TierProgressBar from '@/components/progress/TierProgressBar'
- useStats hook (for tier data instead of just loadStats)

Replace direct loadStats call with useStats hook to get tier, tierProgress, nextTier.

Create a tier header section between the title and "YOUR STATS" section:
- Container with gap: Spacing.sm for vertical spacing
- Tier name: Typography.heading style, colors.text, showing tier.name (e.g., "Resident")
- Subtext (optional): Show "X games to [nextTier.name]" in Typography.footnote, colors.textMuted. If at max tier, show "Mastery achieved" or similar.
- TierProgressBar with progress={tierProgress}

Entry animation: FadeInUp.delay(Durations.stagger).duration(Durations.normal).springify()
(This pushes subsequent sections to stagger * 2, stagger * 3, etc.)

Keep the rest of the screen layout as-is, just update the stagger delays for subsequent sections if needed to maintain the cascade effect.

Styling guidance from CONTEXT.md:
- Progress bar is thin and understated
- Tier name is the main visual element
- No percentages or numbers on the bar itself
  </action>
  <verify>
Run the app, navigate to Progress tab. Tier name displays. Progress bar animates in. Bar fills appropriately based on gamesPlayed.
  </verify>
  <done>
Progress screen shows tier header at top with current tier name (e.g., "Resident"), thin progress bar, and games-to-next info. Entry animation staggered properly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Results screen tier display</name>
  <files>medtriad/app/quiz/results.tsx</files>
  <action>
Update the mastery badge section to show the new tier system instead of the old level system.

Current code (lines 186-191):
```
<Text style={[styles.masteryText, { color: colors.primary }]}>
  {questionsToNext > 0
    ? `+${QUESTION_COUNT} questions toward Level ${level + 1}`
    : `Level ${level} Master!`}
</Text>
```

Change to use tier from useStats:
- Get tier, nextTier from useStats() (it already destructures { stats } so add { stats, tier, nextTier })
- Update the text to show tier name instead of level number

New text logic:
- If nextTier exists: "Playing as [tier.name]" (simple, clean)
- If at max tier (nextTier is null): "[tier.name] - Mastery achieved" or just "[tier.name]" with a subtle indicator

Keep the masteryBadge styling (primaryLight background, pill shape).

Remove old imports/usage:
- Remove: calculateLevel, getQuestionsToNextLevel from mastery.ts imports
- Remove: level, questionsToNext calculations

The badge stays as a subtle reinforcement of progression, not the main focus (tier display will be prominent on Home in Phase 12).
  </action>
  <verify>
Run a quiz, complete it, arrive at results. Tier name (e.g., "Resident") appears in the mastery badge area. Text is clean and readable.
  </verify>
  <done>
Results screen shows current tier name in mastery badge. Old level system references removed. Badge text is simple: "Playing as [TierName]" or tier name at max.
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove deprecated mastery functions (cleanup)</name>
  <files>medtriad/services/mastery.ts</files>
  <action>
Now that screens are updated, remove the deprecated functions that are no longer used.

Check imports across codebase:
- MasteryBar.tsx still uses calculateLevel and getTotalProgress
- Other files may still reference old functions

If MasteryBar.tsx is still importing old functions:
- Option A: Update MasteryBar to use new tier system (if it's used anywhere)
- Option B: Check if MasteryBar is used on Home screen - if Phase 12 will replace it, leave it for now

For this task, focus on removing only functions that have NO remaining imports:
- Search codebase for each function: calculateLevel, getProgressInLevel, getQuestionsToNextLevel, getTotalProgress, getLevelTitle
- Remove functions with zero imports
- Keep functions that are still imported (even if deprecated, to avoid breaking changes)

Update file header comment to reflect the new 6-tier game-based system.

If all old functions are still in use, just update the header comment and leave them with @deprecated JSDoc tags.
  </action>
  <verify>
TypeScript compiles. App runs without errors. No console errors about missing functions.
  </verify>
  <done>
mastery.ts cleaned up - unused old functions removed or marked @deprecated. File header documents the 6-tier game-based system.
  </done>
</task>

</tasks>

<verification>
- [ ] Progress screen shows tier name prominently
- [ ] Progress screen has thin progress bar with correct fill
- [ ] Progress screen shows games-to-next-tier info
- [ ] Results screen shows tier name in mastery badge
- [ ] No TypeScript errors
- [ ] App runs without console errors
- [ ] Old level references replaced with tier names
</verification>

<success_criteria>
1. User can see their current tier name on Progress screen
2. User can see progress toward next tier via thin progress bar
3. User sees tier name after completing a quiz on Results screen
4. No broken references to old mastery system
</success_criteria>

<output>
After completion, create `.planning/phases/11-level-system/11-02-SUMMARY.md`
</output>
