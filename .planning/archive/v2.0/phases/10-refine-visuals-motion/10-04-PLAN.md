# Plan 10-04: Elevate Combo Multiplier Pop

## Frontmatter

```yaml
phase: 10
plan: 04
wave: 2
depends_on: [10-01]
files_modified:
  - medtriad/components/quiz/ScoreDisplay.tsx
autonomous: true
estimated_tasks: 2
requirements: [VISREF-04]
```

## Objective

Make the combo multiplier feel like a reward. When the combo increases, the badge should "pop" with satisfying overshoot and settle, drawing attention to the streak. This is a high-impact moment — streaks are exciting.

**Design Principle:** Celebrate progress. The combo multiplier is positive reinforcement — it should feel like winning.

## Context

Current state:
- Combo badge pulses with simple withTiming (1 → 1.15 → 1)
- Animation is subtle, easy to miss
- Uses timing-based animation (linear feel)

Enhancement strategy:
1. Use spring-based animation for organic feel
2. Add overshoot for "pop" effect
3. Make the pop more dramatic (1.3 instead of 1.15)
4. Consider brief background pulse for extra emphasis

## Tasks

<task id="1">
<title>Enhance combo pop animation</title>
<intent>Make combo increase feel celebratory with dramatic spring-based pop</intent>
<instructions>
In ScoreDisplay.tsx:

1. Import spring utilities and Easings:
```typescript
import Animated, {
  useSharedValue,
  useAnimatedStyle,
  withSequence,
  withSpring,
} from 'react-native-reanimated';
import { Colors, Typography, Spacing, Radius, Easings } from '@/constants/theme';
```

2. Add background pulse value:
```typescript
const scale = useSharedValue(1);
const bgOpacity = useSharedValue(0);
```

3. Update the combo increase effect:
```typescript
useEffect(() => {
  if (combo > previousCombo.current) {
    // Pop animation: overshoot then settle
    scale.value = withSequence(
      withSpring(1.35, Easings.pop),     // Dramatic overshoot
      withSpring(1, Easings.gentle)       // Gentle settle
    );

    // Brief background flash
    bgOpacity.value = withSequence(
      withSpring(1, Easings.pop),
      withSpring(0, { damping: 20, stiffness: 100 })
    );
  }
  previousCombo.current = combo;
}, [combo, scale]);
```

4. Add background style for glow effect:
```typescript
const bgAnimatedStyle = useAnimatedStyle(() => ({
  opacity: bgOpacity.value * 0.3,
}));
```

5. Update the combo badge JSX to include glow:
```typescript
{combo > 1 && (
  <View style={styles.comboWrapper}>
    {/* Glow layer */}
    <Animated.View
      style={[
        styles.comboGlow,
        { backgroundColor: colors.primary },
        bgAnimatedStyle,
      ]}
    />
    {/* Badge */}
    <Animated.View
      style={[
        styles.comboBadge,
        {
          backgroundColor: colors.backgroundSecondary,
          borderColor: colors.border,
        },
        comboBadgeAnimatedStyle,
      ]}
    >
      <Text style={[styles.comboText, { color: colors.text }]}>×{combo}</Text>
    </Animated.View>
  </View>
)}
```

6. Add styles for the glow and wrapper:
```typescript
comboWrapper: {
  position: 'relative',
},
comboGlow: {
  position: 'absolute',
  top: -4,
  left: -4,
  right: -4,
  bottom: -4,
  borderRadius: Radius.full,
},
```
</instructions>
<verification>
- [ ] Combo badge pops dramatically when combo increases
- [ ] Uses spring physics (not timing)
- [ ] Overshoot is noticeable (1.35 scale)
- [ ] Settle feels weighted and organic
- [ ] Brief glow flash accompanies pop
</verification>
</task>

<task id="2">
<title>Test combo animations in quiz</title>
<intent>Verify combo pop feels rewarding during gameplay</intent>
<instructions>
1. Start a quiz and answer questions correctly in a row
2. Watch the combo multiplier as it increases
3. Verify:
   - Pop is dramatic and noticeable
   - Animation feels celebratory, not jarring
   - Glow flash is subtle but adds emphasis
   - Multiple consecutive correct answers each trigger the pop
4. Answer incorrectly to reset combo, then build it again
</instructions>
<verification>
- [ ] Combo pop is clearly visible and satisfying
- [ ] Each combo increase triggers animation
- [ ] Glow effect is subtle enhancement
- [ ] Animation doesn't interfere with gameplay
- [ ] Feels rewarding without being distracting
</verification>
</task>

## Verification Criteria

- [ ] Combo multiplier uses spring-based pop animation
- [ ] Scale overshoots to 1.35 then settles to 1
- [ ] Uses Easings.pop for overshoot, Easings.gentle for settle
- [ ] Brief glow flash accompanies the pop
- [ ] Animation feels celebratory and rewarding

## Must-Haves (Goal-Backward)

For VISREF-04 "Polished motion throughout" and success criteria "Combo multiplier pulses on increase":
- [ ] Combo pop is dramatic and noticeable
- [ ] Uses spring physics for organic feel
- [ ] Each combo increase triggers the animation

## Rollback

If issues occur:
1. Revert to original timing-based pulse
2. Remove glow effect if it causes issues
3. Combo functionality remains intact
