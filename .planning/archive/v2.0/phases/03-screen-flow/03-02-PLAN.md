---
phase: 03-screen-flow
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/app/quiz/index.tsx
  - medtriad/app/quiz/results.tsx
autonomous: true

must_haves:
  truths:
    - "Results screen displays final score"
    - "Results screen displays correct count as X/10"
    - "Results screen displays best streak from the round"
    - "Results screen shows 'New High Score!' badge when score exceeds previous high"
    - "User can tap Play Again to start new quiz"
    - "User can tap Home to return to home screen"
  artifacts:
    - path: "medtriad/app/quiz/index.tsx"
      provides: "Tracks correct count and max combo, passes via URL params"
      contains: "correctCount"
    - path: "medtriad/app/quiz/results.tsx"
      provides: "Full results UI with score, stats, badge, buttons"
      min_lines: 100
  key_links:
    - from: "app/quiz/index.tsx"
      to: "/quiz/results"
      via: "router.replace with params"
      pattern: "router\\.replace.*pathname.*results.*params"
    - from: "app/quiz/results.tsx"
      to: "useLocalSearchParams"
      via: "reads score, correctCount, bestStreak, isNewHighScore"
      pattern: "useLocalSearchParams"
---

<objective>
Complete results screen UI and wire quiz to pass results via URL params.

Purpose: Delivers the satisfying end-of-round experience showing final score, performance stats, and navigation options.
Output: Results screen displaying score, correct count (X/10), best streak, high score badge, and Play Again/Home buttons.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-screen-flow/03-RESEARCH.md

@medtriad/app/quiz/index.tsx
@medtriad/app/quiz/results.tsx
@medtriad/components/results/HighScoreBadge.tsx
@medtriad/components/ui/Button.tsx
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Track and pass quiz results via URL params</name>
  <files>medtriad/app/quiz/index.tsx</files>
  <action>
Modify the quiz screen to track correct answers and max combo, then pass them to results:

1. **Add tracking refs (below state declarations):**
   ```typescript
   // Track results for passing to results screen
   const correctCountRef = useRef(0);
   const maxComboRef = useRef(1);
   ```

2. **Update handleAnswerSelect to track correct answers:**
   After the dispatch call in handleAnswerSelect, add:
   ```typescript
   if (option.isCorrect) {
     correctCountRef.current += 1;
     // Track max combo achieved (combo will increment to this value)
     const newCombo = state.combo + 1;
     if (newCombo > maxComboRef.current) {
       maxComboRef.current = newCombo;
     }
   }
   ```

3. **Update navigation to pass params:**
   In the useEffect that handles auto-advance, change the router.replace call:
   ```typescript
   router.replace({
     pathname: '/quiz/results',
     params: {
       score: state.score.toString(),
       correctCount: correctCountRef.current.toString(),
       bestStreak: maxComboRef.current.toString(),
       isNewHighScore: 'false', // Phase 5 will implement actual check
     },
   });
   ```

4. **Add useRef import:**
   Ensure useRef is imported from 'react' alongside useEffect and useCallback.

Note: For Phase 3, isNewHighScore is always 'false' since persistence is Phase 5. The badge will show when we have persistent high scores to compare against.
  </action>
  <verify>
TypeScript compiles:
```bash
cd medtriad && npx tsc --noEmit
```

Complete a quiz and observe URL contains params (check console or network if needed).
  </verify>
  <done>Quiz screen tracks correct count and max combo, passes them via URL params to results screen</done>
</task>

<task type="auto">
  <name>Task 2: Build complete results screen</name>
  <files>medtriad/app/quiz/results.tsx</files>
  <action>
Replace the placeholder results screen with the full UI:

1. **Add imports:**
   ```typescript
   import { useLocalSearchParams } from 'expo-router';
   import { HighScoreBadge } from '@/components/results/HighScoreBadge';
   import { Button } from '@/components/ui/Button';
   ```

2. **Define params type:**
   ```typescript
   type ResultsParams = {
     score: string;
     correctCount: string;
     bestStreak: string;
     isNewHighScore: string;
   };
   ```

3. **Parse params in component:**
   ```typescript
   const params = useLocalSearchParams<ResultsParams>();

   const score = parseInt(params.score ?? '0', 10);
   const correctCount = parseInt(params.correctCount ?? '0', 10);
   const bestStreak = parseInt(params.bestStreak ?? '1', 10);
   const isNewHighScore = params.isNewHighScore === 'true';
   ```

4. **Build layout:**
   ```
   SafeAreaView (flex: 1, backgroundColor)
     View (content - flex: 1, alignItems: center, justifyContent: center, gap)
       {isNewHighScore && HighScoreBadge}
       View (scoreSection - alignItems: center, gap)
         Text (scoreLabel - "Final Score")
         Text (score - large display number)
       View (statsRow - flexDirection: row, alignItems: center, gap)
         View (stat - correct count)
           Text (statValue - "{correctCount}/10")
           Text (statLabel - "Correct")
         View (divider - vertical line)
         View (stat - best streak)
           Text (statValue - "{bestStreak}x")
           Text (statLabel - "Best Streak")
     View (buttons - padding, gap)
       Button (Play Again - primary)
       Button (Home - secondary)
   ```

5. **Styling:**
   - Score uses Typography.display (64pt, bold)
   - Score label uses Typography.caption with uppercase, letter-spacing: 1
   - Stat values use Typography.heading
   - Stat labels use Typography.footnote
   - Divider: width: 1, height: 40, backgroundColor: colors.border
   - Use Spacing constants for gaps and padding

6. **Button handlers:**
   - Play Again: router.replace('/quiz')
   - Home: router.replace('/(tabs)')

Follow the exact structure from 03-RESEARCH.md "Complete Results Screen Structure" section.
  </action>
  <verify>
1. TypeScript compiles:
```bash
cd medtriad && npx tsc --noEmit
```

2. Visual check after completing a quiz:
   - Score displays as large number
   - Shows "X/10 Correct" (where X is actual correct count)
   - Shows "Nx Best Streak" (where N is max combo achieved)
   - Play Again and Home buttons work
  </verify>
  <done>Results screen displays final score, correct count (X/10), best streak (Nx), and functional navigation buttons</done>
</task>

</tasks>

<verification>
1. Complete a full 10-question quiz
2. Results screen appears with:
   - Final score prominently displayed
   - Correct count showing "X/10"
   - Best streak showing "Nx"
3. High score badge not shown (expected - Phase 5 will enable this)
4. "Play Again" starts a new quiz
5. "Home" returns to home screen
6. Dark mode styling correct
</verification>

<success_criteria>
- RESU-01: User sees final score displayed (animation deferred to Phase 6)
- RESU-02: User sees questions correct as X/10
- RESU-03: User sees best streak achieved this round
- RESU-04: High score badge infrastructure exists (shows when isNewHighScore='true')
- RESU-05: Play Again button starts new round
- RESU-06: Home button returns to home screen
</success_criteria>

<output>
After completion, create `.planning/phases/03-screen-flow/03-02-SUMMARY.md`
</output>
