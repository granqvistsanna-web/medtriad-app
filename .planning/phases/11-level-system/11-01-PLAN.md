---
phase: 11-level-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/services/mastery.ts
  - medtriad/hooks/useStats.ts
  - medtriad/components/progress/TierProgressBar.tsx
autonomous: true

must_haves:
  truths:
    - "6 named tiers exist: Student, Intern, Resident, Doctor, Specialist, Chief"
    - "Tiers are based on gamesPlayed thresholds: 0, 10, 25, 50, 100, 200"
    - "Progress toward next tier is calculable as 0-1 value"
    - "useStats hook provides tier name, progress, and next tier info"
  artifacts:
    - path: "medtriad/services/mastery.ts"
      provides: "Tier definitions and calculation functions"
      exports: ["TIERS", "TierDefinition", "getTierForGames", "getProgressToNextTier", "getNextTier"]
    - path: "medtriad/hooks/useStats.ts"
      provides: "Tier data exposed to components"
      exports: ["tier", "tierProgress", "nextTier"]
    - path: "medtriad/components/progress/TierProgressBar.tsx"
      provides: "Thin animated progress bar component"
      exports: ["TierProgressBar"]
  key_links:
    - from: "medtriad/hooks/useStats.ts"
      to: "medtriad/services/mastery.ts"
      via: "imports tier functions"
      pattern: "getTierForGames|getProgressToNextTier"
---

<objective>
Implement the 6-tier progression system core: tier definitions, calculation logic, hook integration, and progress bar component.

Purpose: Establish the data layer and reusable UI component for the tier system before screen integration.
Output: Working tier calculations accessible via useStats hook, plus a TierProgressBar component ready for use.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-level-system/11-CONTEXT.md
@.planning/phases/11-level-system/11-RESEARCH.md

@medtriad/services/mastery.ts
@medtriad/hooks/useStats.ts
@medtriad/components/home/MasteryBar.tsx
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor mastery.ts for 6-tier game-based system</name>
  <files>medtriad/services/mastery.ts</files>
  <action>
Replace the existing 11-tier question-based mastery system with the new 6-tier game-based system.

Create TierDefinition interface and TIERS constant array:
- Tier 1: Student (0 games)
- Tier 2: Intern (10 games)
- Tier 3: Resident (25 games)
- Tier 4: Doctor (50 games)
- Tier 5: Specialist (100 games)
- Tier 6: Chief (200 games)

Implement new functions:
- getTierForGames(gamesPlayed): Returns TierDefinition for current tier (find highest tier where gamesRequired <= gamesPlayed)
- getNextTier(currentTier): Returns next TierDefinition or null if at max
- getProgressToNextTier(gamesPlayed): Returns 0-1 progress (1 if max tier reached)

Keep existing functions (calculateLevel, getProgressInLevel, getLevelTitle, etc.) for backward compatibility - they're still used in components that will be updated in Plan 02.

Edge cases:
- 0 games = Student, progress 0
- 10 games exactly = Intern, progress 0
- 200+ games = Chief, progress 1 (bar stays full)
  </action>
  <verify>
Create a simple test in the file comments or mental verification:
- getTierForGames(0).name === 'Student'
- getTierForGames(10).name === 'Intern'
- getTierForGames(199).name === 'Specialist'
- getTierForGames(200).name === 'Chief'
- getProgressToNextTier(5) === 0.5 (halfway to Intern)
- getProgressToNextTier(200) === 1 (max tier)
  </verify>
  <done>
TIERS constant exported with 6 named tiers. getTierForGames, getNextTier, and getProgressToNextTier functions work correctly for all edge cases.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend useStats hook with tier data</name>
  <files>medtriad/hooks/useStats.ts</files>
  <action>
Import the new tier functions from mastery.ts:
- getTierForGames
- getProgressToNextTier
- getNextTier
- TierDefinition type

Add to StatsData interface:
- tier: TierDefinition
- tierProgress: number (0-1)
- nextTier: TierDefinition | null

In the hook's derived values section, compute:
- const gamesPlayed = stats?.gamesPlayed ?? 0;
- const tier = getTierForGames(gamesPlayed);
- const tierProgress = getProgressToNextTier(gamesPlayed);
- const nextTier = getNextTier(tier.tier);

Add these to the return object.

Keep existing masteryLevel, masteryProgress, questionsToNextLevel, levelTitle exports for backward compatibility until Plan 02 updates the screens.
  </action>
  <verify>
TypeScript compiles without errors. The hook can be used and tier data is accessible.
  </verify>
  <done>
useStats hook exports tier, tierProgress, and nextTier. Components can access tier.name, tierProgress (0-1), and nextTier for display.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create TierProgressBar component</name>
  <files>medtriad/components/progress/TierProgressBar.tsx</files>
  <action>
Create a new file at medtriad/components/progress/TierProgressBar.tsx.

Build a thin, understated progress bar component following the CONTEXT.md decisions:
- Height: 4-6px (user specified "thin line style")
- No percentage text, bar only
- Uses colors.primary for fill (no tier-specific colors)
- Uses colors.border for track background
- Animated fill using react-native-reanimated withTiming

Props:
- progress: number (0-1)

Implementation pattern from MasteryBar.tsx:
- useSharedValue for animatedProgress
- useEffect to animate when progress changes
- duration: 600ms with Easing.out(Easing.cubic)
- useAnimatedStyle for width percentage

Styling:
- Track: 4px height, Radius.full for rounded ends, overflow: hidden
- Fill: 100% height, Radius.full, backgroundColor: colors.primary
- No entry animation (let parent handle that)
- No container padding (let parent control spacing)
  </action>
  <verify>
File exists at medtriad/components/progress/TierProgressBar.tsx. TypeScript compiles. Component exports TierProgressBar.
  </verify>
  <done>
TierProgressBar component created with thin styling (4px), animated fill, using app's primary color. Ready for integration into Progress and Results screens.
  </done>
</task>

</tasks>

<verification>
- [ ] TIERS constant has exactly 6 entries with correct thresholds
- [ ] getTierForGames returns correct tier for boundary values (0, 10, 25, 50, 100, 200)
- [ ] getProgressToNextTier returns 0 at tier boundaries, 1 at max tier
- [ ] useStats hook compiles and exports tier, tierProgress, nextTier
- [ ] TierProgressBar component renders a thin animated bar
- [ ] No TypeScript errors in modified files
</verification>

<success_criteria>
1. Tier logic correctly maps gamesPlayed to 6 named tiers
2. Progress calculation works for all edge cases including max tier
3. useStats provides tier data to any component that needs it
4. TierProgressBar is a reusable, styled component ready for screen integration
</success_criteria>

<output>
After completion, create `.planning/phases/11-level-system/11-01-SUMMARY.md`
</output>
