---
phase: 21-design-system-foundation
plan: 03
type: execute
wave: 3
depends_on: ["21-02"]
files_modified:
  - medtriad/components/primitives/Text.tsx
  - medtriad/components/primitives/Button.tsx
  - medtriad/components/primitives/index.ts
autonomous: true

must_haves:
  truths:
    - "Text renders with Figtree font at all variants"
    - "Text respects typography tokens (no hardcoded font sizes)"
    - "Button shows loading state with ActivityIndicator"
    - "Button shows disabled state with reduced opacity"
    - "Button has Duolingo-style 3D press animation"
  artifacts:
    - path: "medtriad/components/primitives/Text.tsx"
      provides: "Typography primitive with variants"
      exports: ["Text", "TextVariant"]
    - path: "medtriad/components/primitives/Button.tsx"
      provides: "Button with all states"
      exports: ["Button"]
  key_links:
    - from: "medtriad/components/primitives/Text.tsx"
      to: "medtriad/constants/tokens/typography.ts"
      via: "fontFamily import"
      pattern: "fontFamily"
    - from: "medtriad/components/primitives/Button.tsx"
      to: "react-native-reanimated"
      via: "press animation"
      pattern: "useAnimatedStyle"
---

<objective>
Create the Text primitive and enhance Button with loading state.

Purpose: Text is the most commonly used primitive - it ensures all text in the app uses Figtree with consistent typography tokens. Button enhancement adds the loading state required by DS-06.

Output: Text primitive with 8 variants, Button with default/pressed/disabled/loading states.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-design-system-foundation/21-02-SUMMARY.md
@.planning/phases/21-design-system-foundation/21-RESEARCH.md
@medtriad/constants/theme.ts
@medtriad/constants/tokens/typography.ts
@medtriad/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Text primitive</name>
  <files>medtriad/components/primitives/Text.tsx</files>
  <action>
  Create a comprehensive Text primitive that uses Figtree and typography tokens:

  ```typescript
  import { Text as RNText, StyleSheet, type TextStyle, type TextProps as RNTextProps } from 'react-native';
  import { theme } from '@/constants/theme';
  import { fontFamily } from '@/constants/tokens/typography';

  export type TextVariant =
    | 'display'   // 64px - Hero numbers (results score)
    | 'title'     // 32px - Screen titles
    | 'titleLarge'// 28px - Large title (MedTriads on home)
    | 'heading'   // 22px - Section headers
    | 'body'      // 18px - Body text, card titles
    | 'label'     // 17px - Button labels
    | 'stat'      // 24px - Stats values, extra bold
    | 'caption'   // 15px - Secondary info
    | 'footnote'  // 13px - Small details
    | 'tiny';     // 11px - Category labels

  export type TextColor = keyof typeof theme.colors.text;

  type TextWeight = 'regular' | 'medium' | 'semibold' | 'bold' | 'extrabold';

  type TextProps = RNTextProps & {
    variant?: TextVariant;
    color?: TextColor | string;
    weight?: TextWeight;
    align?: 'left' | 'center' | 'right';
    children: React.ReactNode;
  };

  // Map weight names to font family names
  const WEIGHT_TO_FONT: Record<TextWeight, string> = {
    regular: fontFamily.regular,
    medium: fontFamily.medium,
    semibold: fontFamily.semibold,
    bold: fontFamily.bold,
    extrabold: fontFamily.extrabold,
  };

  // Default weights for each variant
  const VARIANT_DEFAULT_WEIGHT: Record<TextVariant, TextWeight> = {
    display: 'bold',
    title: 'bold',
    titleLarge: 'semibold',
    heading: 'semibold',
    body: 'medium',
    label: 'semibold',
    stat: 'extrabold',
    caption: 'regular',
    footnote: 'regular',
    tiny: 'semibold',
  };

  export function Text({
    variant = 'body',
    color = 'primary',
    weight,
    align,
    style,
    children,
    ...props
  }: TextProps) {
    // Get typography values from theme
    const typography = theme.typography[variant];

    // Determine font family based on weight (explicit weight overrides variant default)
    const effectiveWeight = weight ?? VARIANT_DEFAULT_WEIGHT[variant];
    const fontFamilyName = WEIGHT_TO_FONT[effectiveWeight];

    // Resolve color - support both semantic keys and raw colors
    const textColor = color in theme.colors.text
      ? theme.colors.text[color as TextColor]
      : color;

    return (
      <RNText
        style={[
          {
            fontFamily: fontFamilyName,
            fontSize: typography.fontSize,
            lineHeight: typography.lineHeight,
            letterSpacing: typography.letterSpacing ?? 0,
            color: textColor,
            textAlign: align,
          },
          style,
        ]}
        {...props}
      >
        {children}
      </RNText>
    );
  }
  ```

  IMPORTANT:
  - Do NOT use fontWeight prop - use fontFamily with specific weight instead
  - React Native requires explicit font family names for custom fonts
  - Include letterSpacing from typography tokens when defined
  - Support raw color strings for flexibility (theme colors or hex)
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - Text renders with Figtree font (visual check)
  - Each variant shows correct font size
  - Weight prop changes font family correctly
  - Color prop works with both theme keys and hex values
  </verify>
  <done>
  - Text primitive renders with Figtree
  - All 10 variants work correctly
  - Weight override works
  - Color supports semantic keys and raw values
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Button primitive with loading state</name>
  <files>
    medtriad/components/primitives/Button.tsx
    medtriad/components/primitives/index.ts
  </files>
  <action>
  Create a new Button primitive in primitives/ (NOT replacing ui/Button.tsx yet - that happens in Phase 22):

  ```typescript
  import {
    Pressable,
    ActivityIndicator,
    StyleSheet,
    View,
    type ViewStyle,
  } from 'react-native';
  import Animated, {
    useAnimatedStyle,
    useSharedValue,
    withSpring,
  } from 'react-native-reanimated';
  import { theme } from '@/constants/theme';
  import { Text } from './Text';
  import { Icon } from './Icon';

  type ButtonVariant = 'primary' | 'secondary' | 'outline' | 'ghost';
  type ButtonSize = 'sm' | 'md' | 'lg';

  type ButtonProps = {
    label: string;
    onPress: () => void;
    variant?: ButtonVariant;
    size?: ButtonSize;
    icon?: string;
    iconPosition?: 'left' | 'right';
    loading?: boolean;
    disabled?: boolean;
    fullWidth?: boolean;
    style?: ViewStyle;
  };

  const AnimatedPressable = Animated.createAnimatedComponent(Pressable);

  // Size configurations
  const SIZES: Record<ButtonSize, { height: number; paddingHorizontal: number; iconSize: 'sm' | 'md' }> = {
    sm: { height: 40, paddingHorizontal: 16, iconSize: 'sm' },
    md: { height: 48, paddingHorizontal: 20, iconSize: 'md' },
    lg: { height: 56, paddingHorizontal: 24, iconSize: 'md' },
  };

  // Variant configurations
  const VARIANTS: Record<ButtonVariant, {
    backgroundColor: string;
    borderBottomColor: string;
    textColor: string;
    borderWidth?: number;
    borderColor?: string;
  }> = {
    primary: {
      backgroundColor: theme.colors.brand.primary,
      borderBottomColor: theme.colors.brand.primaryDark,
      textColor: theme.colors.text.inverse,
    },
    secondary: {
      backgroundColor: theme.colors.success.main,
      borderBottomColor: theme.colors.success.dark,
      textColor: theme.colors.text.inverse,
    },
    outline: {
      backgroundColor: theme.colors.surface.card,
      borderBottomColor: theme.colors.border.strong,
      textColor: theme.colors.text.brand,
      borderWidth: 2,
      borderColor: theme.colors.border.default,
    },
    ghost: {
      backgroundColor: 'transparent',
      borderBottomColor: 'transparent',
      textColor: theme.colors.text.brand,
    },
  };

  export function Button({
    label,
    onPress,
    variant = 'primary',
    size = 'lg',
    icon,
    iconPosition = 'left',
    loading = false,
    disabled = false,
    fullWidth = true,
    style,
  }: ButtonProps) {
    const scale = useSharedValue(1);
    const borderBottom = useSharedValue(4);

    const animatedStyle = useAnimatedStyle(() => ({
      transform: [{ scale: scale.value }],
      borderBottomWidth: borderBottom.value,
    }));

    const handlePressIn = () => {
      if (!disabled && !loading) {
        scale.value = withSpring(0.98, theme.motion.press);
        borderBottom.value = withSpring(2, theme.motion.press);
      }
    };

    const handlePressOut = () => {
      scale.value = withSpring(1, theme.motion.press);
      borderBottom.value = withSpring(4, theme.motion.press);
    };

    const variantStyle = VARIANTS[variant];
    const sizeStyle = SIZES[size];
    const isDisabled = disabled || loading;
    const isGhost = variant === 'ghost';

    return (
      <AnimatedPressable
        onPress={onPress}
        onPressIn={handlePressIn}
        onPressOut={handlePressOut}
        disabled={isDisabled}
        style={[
          styles.button,
          {
            height: sizeStyle.height,
            paddingHorizontal: sizeStyle.paddingHorizontal,
            backgroundColor: variantStyle.backgroundColor,
            borderBottomColor: variantStyle.borderBottomColor,
            borderRadius: theme.radius.lg,
            opacity: isDisabled ? 0.5 : 1,
          },
          variantStyle.borderWidth && {
            borderWidth: variantStyle.borderWidth,
            borderColor: variantStyle.borderColor,
          },
          isGhost && { borderBottomWidth: 0 },
          fullWidth && { width: '100%' },
          animatedStyle,
          style,
        ]}
      >
        {loading ? (
          <ActivityIndicator color={variantStyle.textColor} />
        ) : (
          <View style={styles.content}>
            {icon && iconPosition === 'left' && (
              <Icon name={icon} size={sizeStyle.iconSize} color={variantStyle.textColor} />
            )}
            <Text
              variant="label"
              color={variantStyle.textColor}
              weight="bold"
              style={styles.label}
            >
              {label.toUpperCase()}
            </Text>
            {icon && iconPosition === 'right' && (
              <Icon name={icon} size={sizeStyle.iconSize} color={variantStyle.textColor} />
            )}
          </View>
        )}
      </AnimatedPressable>
    );
  }

  const styles = StyleSheet.create({
    button: {
      alignItems: 'center',
      justifyContent: 'center',
      borderBottomWidth: 4,
    },
    content: {
      flexDirection: 'row',
      alignItems: 'center',
      gap: 8,
    },
    label: {
      letterSpacing: 0.5,
    },
  });
  ```

  Update index.ts to export Text and Button:
  ```typescript
  export { Icon, ICON_SIZES } from './Icon';
  export { Surface } from './Surface';
  export { Text, type TextVariant, type TextColor } from './Text';
  export { Button } from './Button';
  ```

  IMPORTANT:
  - Button uses Text primitive (not raw RNText)
  - Button uses Icon primitive
  - Loading state shows ActivityIndicator with correct color
  - Disabled OR loading sets opacity to 0.5
  - Ghost variant has no border-bottom (flat)
  - Duolingo-style 3D press: scale down + reduce borderBottomWidth
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - Button renders with Text primitive (Figtree font)
  - Loading state shows spinner instead of label
  - Disabled state has 50% opacity and is not pressable
  - Press animation works (scale + depth)
  - All four variants render correctly
  </verify>
  <done>
  - Button primitive has loading prop
  - Button primitive has disabled prop
  - Button uses Duolingo-style 3D press animation
  - Button uses Text and Icon primitives internally
  - All four variants (primary, secondary, outline, ghost) work
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Can import: `import { Text, Button } from '@/components/primitives'`
- Text renders with Figtree font (visual check)
- Button loading state shows spinner
- Button disabled state has reduced opacity
- Button press animation works
</verification>

<success_criteria>
- DS-04 COMPLETE: Text primitive component using typography tokens
- DS-06 COMPLETE: Button component with all states (default, pressed, disabled, loading)
- Both primitives use theme tokens exclusively
</success_criteria>

<output>
After completion, create `.planning/phases/21-design-system-foundation/21-03-SUMMARY.md`
</output>
