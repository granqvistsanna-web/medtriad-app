---
phase: 21-design-system-foundation
plan: 04
type: execute
wave: 4
depends_on: ["21-03"]
files_modified:
  - medtriad/components/primitives/Badge.tsx
  - medtriad/components/primitives/Tag.tsx
  - medtriad/components/primitives/Card.tsx
  - medtriad/components/primitives/index.ts
autonomous: true

must_haves:
  truths:
    - "Badge displays status indicators with icon and text"
    - "Tag shows category labels with appropriate styling"
    - "Card provides consistent Duolingo-style container with 3D depth"
    - "All three components use only design tokens (no hardcoded values)"
  artifacts:
    - path: "medtriad/components/primitives/Badge.tsx"
      provides: "Status indicator component"
      exports: ["Badge"]
    - path: "medtriad/components/primitives/Tag.tsx"
      provides: "Label/category component"
      exports: ["Tag"]
    - path: "medtriad/components/primitives/Card.tsx"
      provides: "Container with Duolingo-style depth"
      exports: ["Card"]
  key_links:
    - from: "medtriad/components/primitives/Badge.tsx"
      to: "medtriad/components/primitives/Text.tsx"
      via: "Text primitive"
      pattern: "import.*Text.*from"
    - from: "medtriad/components/primitives/Card.tsx"
      to: "react-native-reanimated"
      via: "press animation"
      pattern: "useAnimatedStyle"
---

<objective>
Create Badge, Tag, and Card primitives to complete the design system foundation.

Purpose: These three components complete the primitive set needed for building all app screens. Badge for status indicators, Tag for category labels, Card for content containers.

Output: Badge, Tag, and Card primitives using Text, Icon, and Surface primitives.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-design-system-foundation/21-03-SUMMARY.md
@.planning/phases/21-design-system-foundation/21-CONTEXT.md
@.planning/phases/21-design-system-foundation/21-RESEARCH.md
@medtriad/constants/theme.ts
@medtriad/components/primitives/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Badge component</name>
  <files>medtriad/components/primitives/Badge.tsx</files>
  <action>
  Create a Badge component for status indicators (streaks, XP, achievements):

  ```typescript
  import { View, StyleSheet, type ViewStyle } from 'react-native';
  import { theme } from '@/constants/theme';
  import { Text } from './Text';
  import { Icon } from './Icon';

  type BadgeVariant = 'default' | 'success' | 'warning' | 'danger' | 'brand' | 'gold' | 'streak';

  type BadgeProps = {
    label: string;
    icon?: string;
    variant?: BadgeVariant;
    size?: 'sm' | 'md';
    style?: ViewStyle;
  };

  // Variant color configurations
  const VARIANTS: Record<BadgeVariant, {
    backgroundColor: string;
    borderColor: string;
    borderBottomColor: string;
    textColor: string;
    iconColor: string;
  }> = {
    default: {
      backgroundColor: theme.colors.surface.secondary,
      borderColor: theme.colors.border.default,
      borderBottomColor: theme.colors.border.strong,
      textColor: theme.colors.text.primary,
      iconColor: theme.colors.text.secondary,
    },
    success: {
      backgroundColor: theme.colors.success.light,
      borderColor: theme.colors.success.main,
      borderBottomColor: theme.colors.success.dark,
      textColor: theme.colors.success.text,
      iconColor: theme.colors.success.main,
    },
    warning: {
      backgroundColor: theme.colors.warning.light,
      borderColor: theme.colors.warning.main,
      borderBottomColor: theme.colors.warning.dark,
      textColor: theme.colors.text.primary,
      iconColor: theme.colors.warning.main,
    },
    danger: {
      backgroundColor: theme.colors.danger.light,
      borderColor: theme.colors.danger.main,
      borderBottomColor: theme.colors.danger.dark,
      textColor: theme.colors.text.primary,
      iconColor: theme.colors.danger.main,
    },
    brand: {
      backgroundColor: theme.colors.surface.brand,
      borderColor: theme.colors.brand.primary,
      borderBottomColor: theme.colors.brand.primaryDark,
      textColor: theme.colors.text.brand,
      iconColor: theme.colors.brand.primary,
    },
    // Gold variant for achievements/stars - uses gold colors from palette
    gold: {
      backgroundColor: '#FFF8E1',  // gold light from existing theme
      borderColor: '#F5B800',       // gold
      borderBottomColor: '#D4A000', // goldDark
      textColor: '#996600',         // goldText
      iconColor: '#F5B800',
    },
    // Streak variant for fire/streak badges
    streak: {
      backgroundColor: '#FFE8E8',   // streakLight
      borderColor: '#FF6B6B',       // streak
      borderBottomColor: '#E85555', // streakDark
      textColor: '#C44545',         // streakText
      iconColor: '#FF6B6B',
    },
  };

  const SIZES = {
    sm: { height: 28, paddingHorizontal: 10, gap: 4, iconSize: 'sm' as const },
    md: { height: 36, paddingHorizontal: 12, gap: 6, iconSize: 'sm' as const },
  };

  export function Badge({
    label,
    icon,
    variant = 'default',
    size = 'md',
    style,
  }: BadgeProps) {
    const colors = VARIANTS[variant];
    const sizeStyle = SIZES[size];

    return (
      <View
        style={[
          styles.badge,
          {
            height: sizeStyle.height,
            paddingHorizontal: sizeStyle.paddingHorizontal,
            backgroundColor: colors.backgroundColor,
            borderColor: colors.borderColor,
            borderBottomColor: colors.borderBottomColor,
          },
          style,
        ]}
      >
        {icon && (
          <Icon name={icon} size={sizeStyle.iconSize} color={colors.iconColor} />
        )}
        <Text
          variant="footnote"
          color={colors.textColor}
          weight="semibold"
          style={{ marginLeft: icon ? sizeStyle.gap : 0 }}
        >
          {label}
        </Text>
      </View>
    );
  }

  const styles = StyleSheet.create({
    badge: {
      flexDirection: 'row',
      alignItems: 'center',
      borderRadius: theme.radius.md,
      borderWidth: 2,
      borderBottomWidth: 3, // Duolingo-style 3D depth
    },
  });
  ```

  IMPORTANT:
  - Duolingo-style 3D depth: borderBottomWidth: 3 with darker color
  - Icon is optional
  - Gold and streak variants use colors from existing theme (not semantic tokens) - add to theme if not there
  - Tonal icon coloring: icon uses variant's accent color
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - Badge renders with icon and text
  - All 7 variants show correct colors
  - 3D border-bottom effect visible
  - Both sizes (sm, md) render correctly
  </verify>
  <done>
  - Badge component exists with 7 variants
  - Badge has Duolingo-style 3D depth
  - Badge uses Text and Icon primitives
  - Icon coloring is tonal (darker shade of background)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Tag component</name>
  <files>medtriad/components/primitives/Tag.tsx</files>
  <action>
  Create a Tag component for category labels:

  ```typescript
  import { View, Pressable, StyleSheet, type ViewStyle } from 'react-native';
  import { theme } from '@/constants/theme';
  import { Text } from './Text';
  import { Icon } from './Icon';

  type TagVariant = 'default' | 'brand' | 'success' | 'info' | 'purple';

  type TagProps = {
    label: string;
    icon?: string;
    variant?: TagVariant;
    onPress?: () => void;
    onRemove?: () => void;
    style?: ViewStyle;
  };

  // Variant configurations - subtle backgrounds with tonal text
  const VARIANTS: Record<TagVariant, {
    backgroundColor: string;
    textColor: string;
    iconColor: string;
  }> = {
    default: {
      backgroundColor: theme.colors.surface.secondary,
      textColor: theme.colors.text.secondary,
      iconColor: theme.colors.text.muted,
    },
    brand: {
      backgroundColor: theme.colors.surface.brand,
      textColor: theme.colors.text.brand,
      iconColor: theme.colors.brand.primary,
    },
    success: {
      backgroundColor: theme.colors.success.light,
      textColor: theme.colors.success.text,
      iconColor: theme.colors.success.main,
    },
    info: {
      backgroundColor: '#E3F2FD', // blue light from palette
      textColor: '#0A5A7C',       // blueText
      iconColor: '#1CB0F6',       // blue
    },
    purple: {
      backgroundColor: '#F3E5F5', // purple light
      textColor: '#5B21B6',       // purpleText
      iconColor: '#A855F7',       // purple
    },
  };

  export function Tag({
    label,
    icon,
    variant = 'default',
    onPress,
    onRemove,
    style,
  }: TagProps) {
    const colors = VARIANTS[variant];
    const isInteractive = !!onPress;

    const content = (
      <View
        style={[
          styles.tag,
          { backgroundColor: colors.backgroundColor },
          style,
        ]}
      >
        {icon && (
          <Icon name={icon} size="sm" color={colors.iconColor} style={styles.icon} />
        )}
        <Text variant="tiny" color={colors.textColor} weight="semibold">
          {label.toUpperCase()}
        </Text>
        {onRemove && (
          <Pressable onPress={onRemove} hitSlop={8} style={styles.removeButton}>
            <Icon name="xmark" size="sm" color={colors.iconColor} />
          </Pressable>
        )}
      </View>
    );

    if (isInteractive) {
      return (
        <Pressable onPress={onPress}>
          {content}
        </Pressable>
      );
    }

    return content;
  }

  const styles = StyleSheet.create({
    tag: {
      flexDirection: 'row',
      alignItems: 'center',
      paddingVertical: 4,
      paddingHorizontal: 10,
      borderRadius: theme.radius.sm,
    },
    icon: {
      marginRight: 4,
    },
    removeButton: {
      marginLeft: 6,
    },
  });
  ```

  IMPORTANT:
  - Tags are FLAT (no 3D depth) - they're labels, not buttons
  - Optional onPress makes it tappable
  - Optional onRemove adds X button
  - Text is uppercase and uses tiny variant
  - Subtle backgrounds with tonal text
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - Tag renders with label text
  - All 5 variants show correct colors
  - Tag is flat (no 3D border effect)
  - onPress makes tag tappable
  - onRemove shows X button
  </verify>
  <done>
  - Tag component exists with 5 variants
  - Tag is flat (not 3D like Badge)
  - Tag supports optional press and remove actions
  - Tag uses Text and Icon primitives
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Card primitive and update exports</name>
  <files>
    medtriad/components/primitives/Card.tsx
    medtriad/components/primitives/index.ts
  </files>
  <action>
  Create a new Card primitive in primitives/ with Duolingo-style 3D depth:

  ```typescript
  import { Pressable, StyleSheet, type ViewStyle } from 'react-native';
  import Animated, {
    useAnimatedStyle,
    useSharedValue,
    withSpring,
  } from 'react-native-reanimated';
  import { theme } from '@/constants/theme';

  type CardVariant = 'default' | 'elevated' | 'outlined';

  type CardProps = {
    children: React.ReactNode;
    variant?: CardVariant;
    onPress?: () => void;
    disabled?: boolean;
    style?: ViewStyle;
  };

  const AnimatedPressable = Animated.createAnimatedComponent(Pressable);

  export function Card({
    children,
    variant = 'default',
    onPress,
    disabled = false,
    style,
  }: CardProps) {
    const scale = useSharedValue(1);
    const borderBottom = useSharedValue(4);

    const animatedStyle = useAnimatedStyle(() => ({
      transform: [{ scale: scale.value }],
      borderBottomWidth: borderBottom.value,
    }));

    const handlePressIn = () => {
      if (onPress && !disabled) {
        scale.value = withSpring(0.98, theme.motion.press);
        borderBottom.value = withSpring(2, theme.motion.press);
      }
    };

    const handlePressOut = () => {
      scale.value = withSpring(1, theme.motion.press);
      borderBottom.value = withSpring(4, theme.motion.press);
    };

    const isInteractive = !!onPress;

    // Variant styles
    const getVariantStyle = () => {
      switch (variant) {
        case 'elevated':
          return {
            backgroundColor: theme.colors.surface.card,
            borderWidth: 0,
            borderBottomWidth: 0,
            ...theme.shadows.md,
          };
        case 'outlined':
          return {
            backgroundColor: theme.colors.surface.card,
            borderWidth: 2,
            borderColor: theme.colors.border.default,
            borderBottomWidth: 4,
            borderBottomColor: theme.colors.border.strong,
          };
        default: // 'default' - Duolingo style with 3D depth
          return {
            backgroundColor: theme.colors.surface.card,
            borderWidth: 2,
            borderColor: theme.colors.border.default,
            borderBottomWidth: 4,
            borderBottomColor: theme.colors.border.strong,
            ...theme.shadows.sm,
          };
      }
    };

    const variantStyle = getVariantStyle();
    const shouldAnimate = isInteractive && variant !== 'elevated';

    return (
      <AnimatedPressable
        onPress={onPress}
        onPressIn={handlePressIn}
        onPressOut={handlePressOut}
        disabled={disabled || !isInteractive}
        style={[
          styles.card,
          variantStyle,
          { opacity: disabled ? 0.5 : 1 },
          shouldAnimate && animatedStyle,
          style,
        ]}
      >
        {children}
      </AnimatedPressable>
    );
  }

  const styles = StyleSheet.create({
    card: {
      borderRadius: theme.radius.lg,
      padding: theme.spacing.lg,
    },
  });
  ```

  Update index.ts to export all primitives:
  ```typescript
  export { Icon, ICON_SIZES } from './Icon';
  export { Surface } from './Surface';
  export { Text, type TextVariant, type TextColor } from './Text';
  export { Button } from './Button';
  export { Badge } from './Badge';
  export { Tag } from './Tag';
  export { Card } from './Card';
  ```

  IMPORTANT:
  - Default variant has Duolingo-style 3D depth (borderBottomWidth: 4)
  - Press animation only on interactive cards (onPress provided)
  - Elevated variant uses shadow only (no borders) - no press animation
  - Outlined variant has borders + 3D depth
  - Disabled state reduces opacity
  </action>
  <verify>
  - `npx tsc --noEmit` passes
  - Card renders with children
  - Default variant shows 3D border effect
  - Elevated variant shows shadow (no borders)
  - Press animation works when onPress provided
  - Can import all 7 primitives from @/components/primitives
  </verify>
  <done>
  - Card primitive exists with 3 variants
  - Card has Duolingo-style 3D press animation (when interactive)
  - All 7 primitives exported: Icon, Surface, Text, Button, Badge, Tag, Card
  - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `ls medtriad/components/primitives/` shows all 7 files + index.ts
- Can import: `import { Icon, Surface, Text, Button, Badge, Tag, Card } from '@/components/primitives'`
- All components render correctly (visual check)
- Badge has 3D depth, Tag is flat
- Card press animation works
</verification>

<success_criteria>
- DS-07 COMPLETE: Badge component for status indicators
- DS-08 COMPLETE: Tag component for labels and categories
- DS-09 COMPLETE: Card component with consistent styling
- All primitives use design tokens exclusively (no hardcoded values except where semantic tokens don't exist)
- Design system foundation is complete
</success_criteria>

<output>
After completion, create `.planning/phases/21-design-system-foundation/21-04-SUMMARY.md`
</output>
