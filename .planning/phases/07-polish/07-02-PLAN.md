---
phase: 07-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/package.json
  - medtriad/hooks/useSoundEffects.ts
  - medtriad/app/quiz/index.tsx
  - medtriad/app/quiz/results.tsx
  - medtriad/components/results/HighScoreBadge.tsx
  - medtriad/assets/sounds/correct.mp3
  - medtriad/assets/sounds/incorrect.mp3
  - medtriad/assets/sounds/combo.mp3
autonomous: true

must_haves:
  truths:
    - "Correct answer plays a soft chime sound"
    - "Incorrect answer plays a subtle low tone"
    - "Combo tier increase plays brief celebratory ding"
    - "Sounds respect user's sound setting (soundEnabled)"
    - "Results score counts up from 0 to final value"
    - "Perfect 10/10 round triggers confetti burst"
    - "High Score badge bounces in with spring animation"
  artifacts:
    - path: "medtriad/hooks/useSoundEffects.ts"
      provides: "Sound playback with settings integration"
      exports: ["useSoundEffects"]
    - path: "medtriad/assets/sounds/correct.mp3"
      provides: "Correct answer sound"
    - path: "medtriad/assets/sounds/incorrect.mp3"
      provides: "Incorrect answer sound"
    - path: "medtriad/assets/sounds/combo.mp3"
      provides: "Combo increase sound"
    - path: "medtriad/app/quiz/results.tsx"
      provides: "Count-up animation and confetti"
      contains: "CountUp"
  key_links:
    - from: "quiz/index.tsx handleAnswerSelect"
      to: "useSoundEffects playSound"
      via: "playSound('correct') or playSound('incorrect')"
      pattern: "playSound\\('correct'\\)|playSound\\('incorrect'\\)"
    - from: "useSoundEffects"
      to: "settings-storage"
      via: "loadSettings().soundEnabled check"
      pattern: "soundEnabled"
    - from: "results.tsx isPerfect"
      to: "ConfettiCannon"
      via: "conditional render + ref.start()"
      pattern: "isPerfect.*ConfettiCannon"
---

<objective>
Add sound effects for quiz feedback and celebratory animations for results screen

Purpose: Create satisfying audio-visual reinforcement for correct/incorrect answers and rewarding results celebration
Output: Sound effects hook, score count-up animation, confetti for perfect rounds, bouncy high score badge
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-polish/07-RESEARCH.md
@.planning/phases/07-polish/07-CONTEXT.md

@medtriad/app/quiz/index.tsx
@medtriad/app/quiz/results.tsx
@medtriad/services/settings-storage.ts
@medtriad/components/results/HighScoreBadge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and add sound assets</name>
  <files>
    medtriad/package.json
    medtriad/assets/sounds/correct.mp3
    medtriad/assets/sounds/incorrect.mp3
    medtriad/assets/sounds/combo.mp3
  </files>
  <action>
    1. Install required packages:
       ```bash
       cd medtriad
       npx expo install expo-audio
       npm install use-count-up react-native-confetti-cannon
       ```

    2. Create sounds directory:
       ```bash
       mkdir -p medtriad/assets/sounds
       ```

    3. Create placeholder sound files using sox (or similar CLI tool):
       - If sox available: Generate simple tones as placeholders
       - If not: Download royalty-free sounds from a source like:
         - https://elevenlabs.io/sound-effects (search "chime", "click", "ding")
         - Or use any short .mp3 files (~300ms each)

       Sound specifications (per user decision - subtle and professional):
       - correct.mp3: Soft positive chime, single note, ~300ms
       - incorrect.mp3: Subtle low tone, non-harsh, ~300ms
       - combo.mp3: Brief ascending ding, ~200ms

       Note: If CLI sound generation isn't available, create empty .mp3 placeholder files
       and add a comment in the code that real sounds should be added. The hook will
       handle missing files gracefully. Alternatively, search for "UI sound pack free"
       and download small .mp3 files.

    4. Verify expo-audio is in package.json after install
  </action>
  <verify>
    - `npm ls expo-audio use-count-up react-native-confetti-cannon` shows all installed
    - `ls medtriad/assets/sounds/` shows correct.mp3, incorrect.mp3, combo.mp3
  </verify>
  <done>Dependencies installed and sound asset files exist in assets/sounds/</done>
</task>

<task type="auto">
  <name>Task 2: Create sound effects hook with settings integration</name>
  <files>medtriad/hooks/useSoundEffects.ts</files>
  <action>
    Create hook that preloads sounds and gates playback based on settings:

    ```typescript
    import { useAudioPlayer } from 'expo-audio';
    import { useCallback, useEffect, useState } from 'react';
    import { loadSettings } from '@/services/settings-storage';

    type SoundType = 'correct' | 'incorrect' | 'combo';

    export function useSoundEffects() {
      const [soundEnabled, setSoundEnabled] = useState(true);

      // Load settings on mount
      useEffect(() => {
        loadSettings().then((settings) => {
          setSoundEnabled(settings.soundEnabled);
        });
      }, []);

      // Preload all sounds with downloadFirst for instant playback
      const correctPlayer = useAudioPlayer(
        require('@/assets/sounds/correct.mp3')
      );
      const incorrectPlayer = useAudioPlayer(
        require('@/assets/sounds/incorrect.mp3')
      );
      const comboPlayer = useAudioPlayer(
        require('@/assets/sounds/combo.mp3')
      );

      const playSound = useCallback((type: SoundType) => {
        if (!soundEnabled) return;

        const player = {
          correct: correctPlayer,
          incorrect: incorrectPlayer,
          combo: comboPlayer,
        }[type];

        // Seek to start for replay capability, then play
        player.seekTo(0);
        player.play();
      }, [soundEnabled, correctPlayer, incorrectPlayer, comboPlayer]);

      // Allow refreshing settings if changed during quiz
      const refreshSettings = useCallback(async () => {
        const settings = await loadSettings();
        setSoundEnabled(settings.soundEnabled);
      }, []);

      return { playSound, refreshSettings };
    }
    ```

    Key implementation details:
    - loadSettings on mount to respect user preference
    - seekTo(0) before play() enables replay without reloading
    - Always check soundEnabled inside playSound, not outside
    - useCallback to prevent unnecessary re-renders
  </action>
  <verify>
    - File exists: `medtriad/hooks/useSoundEffects.ts`
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - Hook exports useSoundEffects function
  </verify>
  <done>useSoundEffects hook created with settings-gated playback</done>
</task>

<task type="auto">
  <name>Task 3: Integrate sounds into quiz and add results animations</name>
  <files>
    medtriad/app/quiz/index.tsx
    medtriad/app/quiz/results.tsx
    medtriad/components/results/HighScoreBadge.tsx
  </files>
  <action>
    **quiz/index.tsx - Add sound triggers:**

    1. Import useSoundEffects:
       ```typescript
       import { useSoundEffects } from '@/hooks/useSoundEffects';
       ```

    2. Add hook in component:
       ```typescript
       const { playSound } = useSoundEffects();
       ```

    3. In handleAnswerSelect, after Haptics.impactAsync call:
       ```typescript
       // Play appropriate sound
       if (option.isCorrect) {
         playSound('correct');
         // Check for combo tier increase
         const currentTier = getComboTier(consecutiveCorrect);
         const newTier = getComboTier(consecutiveCorrect + 1);
         if (newTier > currentTier) {
           // Play combo sound slightly delayed to not overlap
           setTimeout(() => playSound('combo'), 150);
         }
       } else {
         playSound('incorrect');
       }
       ```

    Note: Per user decision - no sound on timeout (visual feedback only).
    The existing timeout handler doesn't need sound added.

    **results.tsx - Add score count-up and confetti:**

    1. Add imports:
       ```typescript
       import { CountUp } from 'use-count-up';
       import ConfettiCannon from 'react-native-confetti-cannon';
       import { useWindowDimensions } from 'react-native';
       ```

    2. Add state for confetti ref:
       ```typescript
       const { width } = useWindowDimensions();
       const confettiRef = useRef<any>(null);
       ```

    3. Add useEffect to trigger confetti for perfect rounds (after existing effects):
       ```typescript
       useEffect(() => {
         if (isPerfect) {
           // Delay to let count-up animation finish
           const timeout = setTimeout(() => {
             confettiRef.current?.start();
           }, 1200); // After 1s count-up + 200ms buffer
           return () => clearTimeout(timeout);
         }
       }, [isPerfect]);
       ```

    4. Replace static score display with CountUp:
       Change:
       ```typescript
       <Text style={[styles.score, { color: colors.primary }]}>
         {score.toLocaleString()}
       </Text>
       ```
       To:
       ```typescript
       <Text style={[styles.score, { color: colors.primary }]}>
         <CountUp
           isCounting
           start={0}
           end={score}
           duration={1}
           thousandsSeparator=","
         />
       </Text>
       ```

    5. Add confetti cannon at the very end of SafeAreaView, before closing tag:
       ```typescript
       {isPerfect && (
         <ConfettiCannon
           ref={confettiRef}
           count={150}
           origin={{ x: width / 2, y: -10 }}
           fallSpeed={3500}
           fadeOut
           autoStart={false}
           colors={['#3B82F6', '#22C55E', '#FACC15', '#F97316', '#EC4899']}
         />
       )}
       ```

    **HighScoreBadge.tsx - Add bounce animation:**

    1. Import ZoomIn from reanimated:
       ```typescript
       import Animated, { ZoomIn } from 'react-native-reanimated';
       ```

    2. Change the container View to Animated.View with entering animation:
       ```typescript
       <Animated.View
         entering={ZoomIn.springify().damping(12)}
         style={[styles.badge, { ... }]}
       >
       ```

    This creates a bouncy "pop" effect when the badge appears.
  </action>
  <verify>
    1. Run app with sound enabled in settings
    2. Play quiz:
       - Correct answer: soft chime plays
       - Incorrect answer: low tone plays
       - Get 3 correct in a row: combo ding plays (after correct chime)
    3. Complete quiz:
       - Score counts up from 0 to final value over ~1 second
       - If perfect 10/10: confetti burst after count-up
       - If new high score: badge bounces in
    4. Toggle sound off in settings, play again:
       - No sounds should play
  </verify>
  <done>Sound effects trigger on quiz actions, results screen has count-up and confetti animations</done>
</task>

</tasks>

<verification>
Full flow test:
1. Settings: Enable sound (default)
2. Start quiz, answer correctly: Hear soft chime, see button scale
3. Answer incorrectly: Hear subtle low tone
4. Get combo tier increase (3 correct): Hear combo ding after correct chime
5. Complete quiz normally: Score counts up smoothly
6. If new high score: Badge bounces in
7. Play again, get perfect 10/10: Confetti bursts after score count-up
8. Settings: Disable sound
9. Play quiz: No sounds should play, haptics still work
</verification>

<success_criteria>
- Correct answer plays soft chime sound
- Incorrect answer plays subtle low tone
- Combo tier increase plays celebratory ding
- Sounds respect soundEnabled setting (no sound when disabled)
- Results score animates from 0 to final value in ~1 second
- Perfect 10/10 round triggers confetti burst
- High Score badge enters with spring zoom animation
- No performance degradation from sound loading
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish/07-02-SUMMARY.md`
</output>
