---
phase: 02-quiz-core
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - medtriad/app/_layout.tsx
  - medtriad/app/quiz/_layout.tsx
  - medtriad/app/quiz/index.tsx
  - medtriad/app/quiz/results.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate from home to quiz screen"
    - "User sees three clinical findings displayed for each question"
    - "User sees four tappable answer options for each question"
    - "User sees progress indicator showing question X of 10"
    - "User sees current score and combo display"
    - "Timer ring displays counting down from 12 seconds"
    - "Tapping an answer advances to the next question"
    - "After question 10, quiz ends and navigates to results"
  artifacts:
    - path: "medtriad/app/quiz/_layout.tsx"
      provides: "Quiz stack navigator with gesture disabled"
      exports: ["default"]
    - path: "medtriad/app/quiz/index.tsx"
      provides: "Main quiz gameplay screen"
      exports: ["default"]
      min_lines: 80
    - path: "medtriad/app/quiz/results.tsx"
      provides: "Placeholder results screen"
      exports: ["default"]
  key_links:
    - from: "medtriad/app/quiz/index.tsx"
      to: "medtriad/hooks/use-quiz-reducer.ts"
      via: "imports useQuizReducer hook"
      pattern: "import.*useQuizReducer.*from.*@/hooks"
    - from: "medtriad/app/quiz/index.tsx"
      to: "medtriad/hooks/use-countdown-timer.ts"
      via: "imports useCountdownTimer hook"
      pattern: "import.*useCountdownTimer.*from.*@/hooks"
    - from: "medtriad/app/quiz/index.tsx"
      to: "medtriad/services/question-generator.ts"
      via: "calls generateQuestionSet"
      pattern: "generateQuestionSet\\(.*\\)"
    - from: "medtriad/app/quiz/index.tsx"
      to: "medtriad/components/quiz/*"
      via: "renders FindingsCard, AnswerCard, TimerRing, ScoreDisplay, ProgressIndicator"
      pattern: "import.*from.*@/components/quiz"
---

<objective>
Build the complete quiz screen with navigation, connecting all Phase 1 components with Phase 2 state management.

Purpose: Create the playable quiz experience where users see findings, select answers, and progress through 10 questions with a countdown timer.

Output: Quiz navigation route with full-screen modal presentation, main quiz screen wiring all components together, and placeholder results screen.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-quiz-core/02-RESEARCH.md

# Plan 02-01 creates the hooks we'll use
# These will exist after 02-01 completes:
# - medtriad/hooks/use-quiz-reducer.ts
# - medtriad/hooks/use-countdown-timer.ts
# - medtriad/types/quiz-state.ts

# Phase 1 components we'll wire together
@medtriad/components/quiz/FindingsCard.tsx
@medtriad/components/quiz/AnswerCard.tsx
@medtriad/components/quiz/TimerRing.tsx
@medtriad/components/quiz/ScoreDisplay.tsx
@medtriad/components/quiz/ProgressIndicator.tsx
@medtriad/services/question-generator.ts
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up quiz navigation routes</name>
  <files>
    medtriad/app/_layout.tsx
    medtriad/app/quiz/_layout.tsx
    medtriad/app/quiz/index.tsx
    medtriad/app/quiz/results.tsx
  </files>
  <action>
1. Update medtriad/app/_layout.tsx:
   - Add quiz route as fullScreenModal presentation
   - Set headerShown: false and gestureEnabled: false for quiz
   - Keep existing (tabs) and modal routes

2. Create medtriad/app/quiz/_layout.tsx:
   - Stack navigator with headerShown: false, gestureEnabled: false on all screens
   - Defines screens: index and results

3. Create medtriad/app/quiz/index.tsx (placeholder for now):
   - Basic SafeAreaView with "Quiz Screen" text
   - Will be replaced in Task 2

4. Create medtriad/app/quiz/results.tsx:
   - Simple placeholder screen with:
     - SafeAreaView, centered content
     - "Results" title text
     - "Play Again" button using Link or router.replace('/quiz')
     - "Home" button using router.replace('/(tabs)')
   - Uses theme colors for styling
   - This is a placeholder - full results in Phase 3

Test navigation: From home, router.push('/quiz') should open quiz as full-screen modal.
  </action>
  <verify>Run `npx expo start`, tap to navigate to /quiz - screen appears full-screen without back gesture</verify>
  <done>Quiz route exists as fullScreenModal, results placeholder exists with working navigation buttons</done>
</task>

<task type="auto">
  <name>Task 2: Build complete quiz screen</name>
  <files>medtriad/app/quiz/index.tsx</files>
  <action>
Replace the placeholder with the full quiz screen implementation:

1. Imports:
   - SafeAreaView, View, StyleSheet from react-native
   - useRouter from expo-router
   - useEffect, useCallback from react
   - Haptics from expo-haptics
   - All quiz components: FindingsCard, AnswerCard, TimerRing, ScoreDisplay, ProgressIndicator
   - useQuizReducer from @/hooks/use-quiz-reducer
   - useCountdownTimer from @/hooks/use-countdown-timer
   - generateQuestionSet from @/services/question-generator
   - QuizOption from @/types
   - QUESTION_COUNT, QUESTION_TIME from @/types/quiz-state
   - Colors, Spacing from @/constants/theme
   - useColorScheme hook

2. Constants:
   - ANSWER_DELAY = 1500 (ms before advancing)

3. Component structure:
   - useQuizReducer() for [state, dispatch]
   - useRouter() for navigation
   - useColorScheme() for theme

4. Initialize on mount (useEffect):
   - Generate questions: generateQuestionSet(QUESTION_COUNT)
   - Dispatch START_QUIZ with questions
   - Empty dependency array - runs once on mount

5. Timer logic:
   - handleTick = useCallback(() => dispatch({ type: 'TICK_TIMER' }), [dispatch])
   - useCountdownTimer(state.status === 'playing', handleTick)

6. Auto-advance after answer (useEffect):
   - Trigger when state.status === 'answered'
   - setTimeout for ANSWER_DELAY
   - If currentIndex >= questions.length - 1: router.replace('/quiz/results')
   - Else: dispatch NEXT_QUESTION
   - Return cleanup to clear timeout
   - Dependencies: [state.status, state.currentIndex, state.questions.length, dispatch, router]

7. handleAnswerSelect function:
   - Receives QuizOption
   - Trigger haptic: Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)
   - Dispatch SELECT_ANSWER with optionId and isCorrect
   - After state update, additional haptic:
     - If correct: Haptics.notificationAsync(NotificationFeedbackType.Success)
     - If incorrect: Haptics.notificationAsync(NotificationFeedbackType.Error)

8. getAnswerState helper:
   - If status !== 'answered': return 'default'
   - If option.id === selectedOptionId: return option.isCorrect ? 'correct' : 'incorrect'
   - If option.isCorrect: return 'revealed'
   - Else: return 'default'

9. Early return:
   - If !currentQuestion: return null (loading state)

10. Render structure:
```
SafeAreaView (flex: 1, backgroundColor from theme)
  View (header row: space-between, horizontal padding)
    ProgressIndicator (current={currentIndex + 1}, total={QUESTION_COUNT})
    TimerRing (seconds={timeRemaining}, totalSeconds={QUESTION_TIME})
    ScoreDisplay (score={score}, combo={combo})

  View (content: flex 1, padding, gap)
    FindingsCard (findings={currentQuestion.triad.findings})

    View (answers container: gap between answers)
      {options.map(option =>
        AnswerCard
          key={option.id}
          condition={option.condition}
          onPress={() => handleAnswerSelect(option)}
          state={getAnswerState(option)}
          disabled={status === 'answered'}
      )}
```

11. StyleSheet:
   - container: flex 1, backgroundColor from colors
   - header: flexDirection row, justifyContent space-between, alignItems center, padding
   - content: flex 1, paddingHorizontal, gap between sections
   - answers: gap between answer cards

Use Colors[scheme] for background. SafeAreaView for proper iOS safe area handling.
  </action>
  <verify>Run app, navigate to /quiz - see findings card, 4 answer options, timer, score, progress. Tapping answer shows correct/incorrect state, waits 1.5s, advances to next question.</verify>
  <done>Complete quiz screen renders all components and handles answer selection with state transitions</done>
</task>

<task type="auto">
  <name>Task 3: Add temporary start button to home</name>
  <files>medtriad/app/(tabs)/index.tsx</files>
  <action>
Add a temporary "Start Quiz" button to the existing home screen template so we can test the quiz flow.

This is NOT the final home screen (that's Phase 3). This is a minimal addition to enable testing.

1. Add import: useRouter from 'expo-router'

2. Add inside the existing HomeScreen component:
   - const router = useRouter()
   - A Pressable/TouchableOpacity styled as a button
   - Text: "Start Quiz"
   - onPress: () => router.push('/quiz')

3. Style the button:
   - Place it after the existing content or in a visible spot
   - Use theme colors (can use ThemedView/ThemedText or inline styles)
   - Make it large enough to tap easily

Keep the existing template content - just add the button. This preserves the ability to see the template while also testing quiz.
  </action>
  <verify>Run app, see "Start Quiz" button on home tab, tapping it opens quiz screen</verify>
  <done>Home screen has working Start Quiz button that navigates to /quiz</done>
</task>

</tasks>

<verification>
After all tasks complete, verify the full quiz flow:

1. App starts on home tab with "Start Quiz" button
2. Tap Start Quiz -> opens quiz as full-screen modal
3. Quiz screen shows:
   - Progress indicator ("Question 1 of 10")
   - Timer ring counting down from 12
   - Three findings in FindingsCard
   - Four answer options in AnswerCards
   - Score display (0 initially, combo x1)
4. Tap an answer:
   - Haptic feedback fires
   - Correct answer shows green, incorrect shows red
   - Correct answer is revealed if wrong selected
   - After 1.5 seconds, advances to next question
5. Timer resets to 12 for each question
6. After question 10, navigates to results placeholder
7. Results screen shows Play Again and Home buttons
8. Play Again restarts quiz, Home returns to home tab

Run: `npx expo start` and test on iOS simulator or device
</verification>

<success_criteria>
- User can complete a full 10-question quiz round
- All 7 Phase 2 requirements are met:
  - QUIZ-01: Three findings displayed (FindingsCard)
  - QUIZ-02: Four answer options (AnswerCard x4)
  - QUIZ-03: Progress indicator (ProgressIndicator)
  - QUIZ-04: Score and combo display (ScoreDisplay)
  - QUIZ-05: Tappable answers (AnswerCard onPress)
  - QUIZ-06: After 10 questions, navigates to results
  - TIME-01: 12-second countdown timer (TimerRing)
- Haptic feedback on answer selection
- Proper state transitions (idle -> playing -> answered -> next...)
- Timer stops when answer selected
- Timer auto-advances on timeout (treated as incorrect)
</success_criteria>

<output>
After completion, create `.planning/phases/02-quiz-core/02-02-SUMMARY.md`
</output>
