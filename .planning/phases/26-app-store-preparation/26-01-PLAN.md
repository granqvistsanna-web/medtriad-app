---
phase: 26-app-store-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/app.json
  - medtriad/eas.json
autonomous: true

must_haves:
  truths:
    - "Production build can be created without privacy manifest errors"
    - "Bundle ID is unique and properly formatted"
    - "App targets iPhone only (no iPad compatibility issues)"
    - "Version management uses EAS remote source for auto-increment"
  artifacts:
    - path: "medtriad/app.json"
      provides: "iOS bundle identifier, privacy manifest, supportsTablet config"
      contains: "bundleIdentifier"
    - path: "medtriad/eas.json"
      provides: "EAS build and submit configuration"
      contains: "autoIncrement"
  key_links:
    - from: "medtriad/app.json"
      to: "App Store Connect"
      via: "bundleIdentifier must match App Store registration"
      pattern: "bundleIdentifier"
    - from: "medtriad/eas.json"
      to: "EAS Build service"
      via: "production profile for iOS builds"
      pattern: "production"
---

<objective>
Configure app.json and eas.json for App Store submission, including bundle identifier, privacy manifest for AsyncStorage, and EAS build/submit profiles.

Purpose: Technical configuration must be correct before any submission attempt
Output: app.json with iOS-specific settings, eas.json with production build and submit profiles
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-app-store-preparation/26-RESEARCH.md
@medtriad/app.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure app.json for iOS App Store</name>
  <files>medtriad/app.json</files>
  <action>
Update app.json with the following iOS-specific configuration:

1. Add `bundleIdentifier` to ios section - use placeholder format "com.YOURNAME.medtriad" with comment for user to customize
2. Add `buildNumber: "1"` to ios section for initial submission
3. Change `supportsTablet: false` (currently true - must be false per research pitfall #5)
4. Add `privacyManifests` with NSUserDefaults declaration (required for AsyncStorage):
   ```json
   "privacyManifests": {
     "NSPrivacyAccessedAPITypes": [
       {
         "NSPrivacyAccessedAPIType": "NSPrivacyAccessedAPICategoryUserDefaults",
         "NSPrivacyAccessedAPITypeReasons": ["CA92.1"]
       }
     ]
   }
   ```

The full ios section should look like:
```json
"ios": {
  "bundleIdentifier": "com.YOURNAME.medtriad",
  "buildNumber": "1",
  "supportsTablet": false,
  "privacyManifests": {
    "NSPrivacyAccessedAPITypes": [
      {
        "NSPrivacyAccessedAPIType": "NSPrivacyAccessedAPICategoryUserDefaults",
        "NSPrivacyAccessedAPITypeReasons": ["CA92.1"]
      }
    ]
  }
}
```

Note: User will need to replace YOURNAME with their actual identifier before submission.
  </action>
  <verify>Read app.json and confirm: bundleIdentifier exists, supportsTablet is false, privacyManifests includes UserDefaults with CA92.1</verify>
  <done>app.json has valid iOS configuration with bundle ID, privacy manifest, and tablet support disabled</done>
</task>

<task type="auto">
  <name>Task 2: Create eas.json for build and submission</name>
  <files>medtriad/eas.json</files>
  <action>
Create eas.json in the medtriad directory with the following configuration:

```json
{
  "cli": {
    "version": ">= 13.0.0",
    "appVersionSource": "remote"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal"
    },
    "preview": {
      "distribution": "internal"
    },
    "production": {
      "ios": {
        "autoIncrement": true
      }
    }
  },
  "submit": {
    "production": {
      "ios": {
        "ascAppId": "YOUR_APP_STORE_CONNECT_APP_ID"
      }
    }
  }
}
```

Key configuration choices:
- `appVersionSource: "remote"` - EAS tracks versions, prevents duplicate build number errors
- `autoIncrement: true` - Automatically increment buildNumber for each production build
- `ascAppId` placeholder - User fills in after creating app in App Store Connect

Note: ascAppId is the numeric ID from App Store Connect (found in app URL after /app/)
  </action>
  <verify>Read eas.json and confirm: cli.appVersionSource is "remote", build.production.ios.autoIncrement is true, submit.production.ios exists</verify>
  <done>eas.json exists with development, preview, and production profiles configured for iOS submission</done>
</task>

</tasks>

<verification>
1. app.json has valid JSON structure (no syntax errors)
2. iOS bundle identifier follows reverse-domain format
3. Privacy manifest includes NSPrivacyAccessedAPICategoryUserDefaults with CA92.1 reason
4. supportsTablet is explicitly set to false
5. eas.json has valid JSON structure
6. EAS production profile has autoIncrement enabled
</verification>

<success_criteria>
- AS-07 partially addressed: Bundle ID format established (user customizes value)
- Both configuration files are valid JSON
- Privacy manifest configured to avoid ITMS-91053 rejection
- EAS ready for `eas build --platform ios --profile production`
</success_criteria>

<output>
After completion, create `.planning/phases/26-app-store-preparation/26-01-SUMMARY.md`
</output>
