# Plan 10-03: Polish Timer Bar Motion

## Frontmatter

```yaml
phase: 10
plan: 03
wave: 2
depends_on: [10-01]
files_modified:
  - medtriad/components/quiz/TimerBar.tsx
autonomous: true
estimated_tasks: 3
requirements: [VISREF-04]
```

## Objective

Transform the timer from functional to delightful. The timer bar should smoothly transition colors as time runs out, creating visual urgency without jarring instant changes. The countdown number should pulse more dramatically at low time.

**Design Principle:** High-impact moments deserve special attention. The timer is the heartbeat of the quiz — it should feel alive.

## Context

Current state:
- Bar width animates smoothly with withTiming
- Color changes are instant (isCritical/isLow conditionals)
- Number pulses via scale at low time

Enhancement strategy:
1. Use interpolateColor for smooth color transitions
2. Enhance number pulse with spring physics
3. Add subtle glow effect at critical time

## Tasks

<task id="1">
<title>Implement smooth color interpolation</title>
<intent>Make timer bar color flow smoothly from teal → yellow → red as time decreases</intent>
<instructions>
In TimerBar.tsx:

1. Import interpolateColor and Easings:
```typescript
import Animated, {
  useAnimatedStyle,
  useSharedValue,
  withTiming,
  withSequence,
  withRepeat,
  withSpring,
  Easing,
  interpolateColor,
} from 'react-native-reanimated';
import { Colors, Typography, Spacing, Radius, Easings, Durations } from '@/constants/theme';
```

2. Create animated progress value that drives color:
```typescript
const animatedProgress = useSharedValue(progress);

useEffect(() => {
  animatedProgress.value = withTiming(progress, {
    duration: 200,
    easing: Easings.easeOut,
  });
}, [progress]);
```

3. Update barAnimatedStyle to use interpolateColor:
```typescript
const barAnimatedStyle = useAnimatedStyle(() => {
  // Color transitions: teal (1.0) → yellow (0.33) → red (0.2) → red (0)
  const backgroundColor = interpolateColor(
    animatedProgress.value,
    [0, 0.2, 0.33, 1],
    [colors.error, colors.error, colors.timerWarning, colors.primary]
  );

  return {
    width: `${animatedProgress.value * 100}%`,
    backgroundColor,
  };
});
```

4. Remove barWidth shared value (replaced by animatedProgress).
</instructions>
<verification>
- [ ] Timer bar color smoothly transitions between states
- [ ] Color flows: teal → yellow → red as time decreases
- [ ] No instant color jumps
- [ ] Width animation still smooth
</verification>
</task>

<task id="2">
<title>Enhance countdown number animation</title>
<intent>Make the number feel more urgent at low time with spring-based pulse</intent>
<instructions>
Update the pulse animation to use springs for more organic feel:

```typescript
// Pulse animation when time is low
useEffect(() => {
  if (isCritical) {
    // Faster, more urgent pulse at critical
    pulse.value = withRepeat(
      withSequence(
        withSpring(1.25, Easings.pop),
        withSpring(1, Easings.gentle)
      ),
      -1,
      false
    );
  } else if (isLow) {
    // Gentler pulse at warning
    pulse.value = withRepeat(
      withSequence(
        withSpring(1.15, Easings.bouncy),
        withSpring(1, Easings.gentle)
      ),
      -1,
      false
    );
  } else {
    pulse.value = withSpring(1, Easings.gentle);
  }
}, [isLow, isCritical]);
```

Also update the text color to animate smoothly:

```typescript
const textAnimatedStyle = useAnimatedStyle(() => {
  const textColor = interpolateColor(
    animatedProgress.value,
    [0, 0.2, 0.33, 1],
    [colors.error, colors.error, colors.timerWarning, colors.text]
  );

  return {
    transform: [{ scale: pulse.value }],
    color: textColor,
  };
});
```

Note: For the animated color to work, wrap the countdown Text in Animated.Text and apply textAnimatedStyle.
</instructions>
<verification>
- [ ] Number pulses with spring physics (not linear timing)
- [ ] Critical state has more urgent pulse than warning
- [ ] Number color transitions smoothly with progress
- [ ] Animations feel organic and weighted
</verification>
</task>

<task id="3">
<title>Test timer transitions</title>
<intent>Verify smooth timer experience during quiz</intent>
<instructions>
1. Start the app and begin a quiz
2. Watch the timer bar as time decreases
3. Verify:
   - Color flows smoothly from teal to yellow to red
   - No jarring color jumps
   - Number pulse feels urgent but not jarring
   - Critical pulse is faster/stronger than warning pulse
4. Complete a few questions to see timer reset behavior
</instructions>
<verification>
- [ ] Color interpolation smooth throughout countdown
- [ ] Pulse feels organic with spring physics
- [ ] Timer resets cleanly between questions
- [ ] No performance issues or jank
</verification>
</task>

## Verification Criteria

- [ ] Timer bar uses interpolateColor for smooth color transitions
- [ ] Countdown number uses spring-based pulse animation
- [ ] Critical state (≤3s) has stronger pulse than warning state (≤5s)
- [ ] All animations use Easings from theme.ts
- [ ] Timer feels alive and urgent without being annoying

## Must-Haves (Goal-Backward)

For VISREF-04 "Polished motion throughout" and success criteria "Timer has fluid countdown animation":
- [ ] Timer color flows smoothly (no instant jumps)
- [ ] Number pulse uses spring physics
- [ ] Different urgency levels have appropriate motion intensity

## Rollback

If issues occur:
1. Revert to instant color changes (less polished but functional)
2. Keep existing linear pulse animation
3. Timer functionality remains intact
