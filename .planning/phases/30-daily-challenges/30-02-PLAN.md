---
phase: 30-daily-challenges
plan: 02
type: execute
wave: 2
depends_on: ["30-01"]
files_modified:
  - medtriad/app/daily-challenge/index.tsx
  - medtriad/app/daily-challenge/results.tsx
  - medtriad/app/daily-challenge/_layout.tsx
  - medtriad/hooks/useDailyChallenge.ts
autonomous: true

must_haves:
  truths:
    - "User can play daily challenge quiz with variant-specific settings"
    - "Speed round has 5 questions with 7-second timer"
    - "Category focus filters questions to one category"
    - "Full challenge has 10 questions with standard timer"
    - "Results screen shows streak milestone celebrations"
    - "Already-completed challenge shows 'completed' state"
  artifacts:
    - path: "medtriad/app/daily-challenge/index.tsx"
      provides: "Daily challenge quiz screen"
      min_lines: 150
    - path: "medtriad/app/daily-challenge/results.tsx"
      provides: "Daily challenge results with streak and milestone display"
      min_lines: 100
    - path: "medtriad/hooks/useDailyChallenge.ts"
      provides: "Hook for daily challenge state and actions"
      exports: ["useDailyChallenge"]
  key_links:
    - from: "medtriad/app/daily-challenge/index.tsx"
      to: "medtriad/services/daily-challenge.ts"
      via: "question generation"
      pattern: "generateDailyChallengeQuestions"
    - from: "medtriad/app/daily-challenge/results.tsx"
      to: "medtriad/services/daily-challenge.ts"
      via: "completion recording"
      pattern: "completeDailyChallenge"
---

<objective>
Create the Daily Challenge UI: quiz screen with variant-specific behavior and results screen with streak milestone celebrations.

Purpose: Let users play daily challenges with speed/category/full variants and see their streak progress.
Output: Complete daily challenge quiz flow from start to results.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/30-daily-challenges/30-01-SUMMARY.md

# Existing quiz patterns to follow
@medtriad/app/quiz/index.tsx
@medtriad/app/quiz/results.tsx
@medtriad/hooks/use-quiz-reducer.ts

# Daily challenge service from 30-01
@medtriad/services/daily-challenge.ts
@medtriad/types/daily-challenge.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDailyChallenge hook</name>
  <files>
    medtriad/hooks/useDailyChallenge.ts
  </files>
  <action>
Create `medtriad/hooks/useDailyChallenge.ts`:

```typescript
import { useState, useEffect, useCallback } from 'react';
import {
  getDailyChallengeState,
  completeDailyChallenge,
  getDailyChallengeConfig,
  generateDailyChallengeQuestions,
} from '@/services/daily-challenge';
import { DailyChallengeConfig, DailyChallengeState } from '@/types/daily-challenge';
import { QuizQuestion } from '@/types';

export interface UseDailyChallengeReturn {
  state: DailyChallengeState | null;
  loading: boolean;
  config: DailyChallengeConfig | null;
  questions: QuizQuestion[];
  refresh: () => Promise<void>;
  complete: () => Promise<{
    newStreak: number;
    earnedStreakFreeze: boolean;
    streakMilestone: number | null;
  }>;
}
```

Implementation:
1. On mount, call `getDailyChallengeState()` to check completion status
2. If not completed, call `getDailyChallengeConfig()` and `generateDailyChallengeQuestions(config)`
3. Store state, config, questions in useState
4. `refresh()` re-fetches state
5. `complete()` calls `completeDailyChallenge()` and returns result

Export the hook.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Hook exports UseDailyChallengeReturn interface
    - Hook properly loads state on mount
  </verify>
  <done>useDailyChallenge hook provides state, config, questions, and completion function</done>
</task>

<task type="auto">
  <name>Task 2: Create daily challenge quiz screen</name>
  <files>
    medtriad/app/daily-challenge/_layout.tsx
    medtriad/app/daily-challenge/index.tsx
  </files>
  <action>
1. Create `medtriad/app/daily-challenge/_layout.tsx`:
   - Simple Stack layout like quiz/_layout.tsx
   - headerShown: false, gestureEnabled: false (no back swipe during quiz)

2. Create `medtriad/app/daily-challenge/index.tsx`:
   - Follow the pattern of `medtriad/app/quiz/index.tsx` but with key differences:

   **Header:**
   - Show challenge type badge (e.g., "SPEED ROUND", "CARDIOLOGY FOCUS", "DAILY CHALLENGE")
   - CancelButton to exit
   - Progress indicator (1 of 5 for speed, 1 of 10 for others)

   **Quiz logic:**
   - Use `useDailyChallenge` hook to get config and questions
   - Use existing `useQuizReducer` for quiz state management
   - Pass `config.questionTime` to START_QUIZ action
   - Pass `config.questionCount` worth of questions

   **Already completed handling:**
   - If `state.completedToday === true`, show "Already Completed" message
   - Display when it was completed and today's streak
   - "Back to Home" button

   **Speed round visual cues:**
   - If type === 'speed', add visual urgency (optional: pulsing timer, different color)
   - Timer bar uses config.questionTime (7 seconds for speed)

   **Category focus visual cues:**
   - If type === 'category', show category name prominently
   - All questions are from that category

   **On quiz complete:**
   - Navigate to daily-challenge/results with params:
     - score, correctCount, challengeType, categoryName (if applicable)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Daily challenge screen loads with correct question count (5 for speed, 10 for others)
    - Timer uses correct duration (7s for speed, 15s for others)
    - Already-completed state shows appropriate message
  </verify>
  <done>Daily challenge quiz screen works with all three variants</done>
</task>

<task type="auto">
  <name>Task 3: Create daily challenge results screen with streak celebrations</name>
  <files>
    medtriad/app/daily-challenge/results.tsx
  </files>
  <action>
Create `medtriad/app/daily-challenge/results.tsx`:

1. **Route params:**
   - score: string
   - correctCount: string
   - total: string
   - challengeType: DailyChallengeType
   - categoryName?: string
   - newStreak: string
   - earnedStreakFreeze: string ('true' | 'false')
   - streakMilestone: string | null ('7' | '30' | '100' | null)

2. **Results display (similar to quiz/results.tsx):**
   - Score display
   - Correct count (e.g., "8/10 correct")
   - Challenge type badge

3. **Streak section:**
   - Show current streak with Fire icon
   - "Day X streak!" message
   - If earnedStreakFreeze === 'true':
     - Show celebratory badge: "Streak Freeze Earned!"
     - Brief explanation: "Miss a day without losing your streak"

4. **Milestone celebrations (DAILY-05):**
   - If streakMilestone is 7, 30, or 100:
     - Show celebration overlay (adapt TierUpCelebration pattern)
     - 7 days: "One Week!" message with confetti
     - 30 days: "One Month!" message with confetti
     - 100 days: "100 Days!" message with confetti, extra fanfare
   - Use existing ConfettiCannon component
   - Celebration auto-dismisses or has "Continue" button

5. **Action buttons:**
   - "Back to Home" (primary)
   - "Share" (secondary, optional - can reuse share pattern)

6. **Integration:**
   - Results screen calls `completeDailyChallenge()` via useDailyChallenge hook on mount
   - This ensures completion is recorded when viewing results
   - Handle case where completion fails gracefully (still show results)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Results screen displays score, streak, challenge type
    - Streak milestone celebrations trigger for 7, 30, 100 day streaks
    - "Back to Home" navigates correctly
  </verify>
  <done>Daily challenge results screen complete with streak celebrations for milestones</done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` passes
2. Daily challenge quiz flow works end-to-end
3. Speed round: 5 questions, 7-second timer
4. Category focus: 10 questions, all from same category
5. Full challenge: 10 questions, 15-second timer
6. Already-completed daily shows appropriate state
7. Results screen shows streak and handles milestones
</verification>

<success_criteria>
- Daily challenge quiz screen works with all three variants
- Timer and question count adjust based on challenge type
- Results screen records completion and shows streak
- Milestone celebrations (7, 30, 100 days) display with confetti
- Already-completed state prevents replay
- Navigation works: home -> daily challenge -> results -> home
</success_criteria>

<output>
After completion, create `.planning/phases/30-daily-challenges/30-02-SUMMARY.md`
</output>
