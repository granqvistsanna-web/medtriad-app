---
phase: 29-spaced-repetition
plan: 03
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - medtriad/components/home/ReviewDueBadge.tsx
  - medtriad/components/home/ActionButtons.tsx
  - medtriad/app/(tabs)/index.tsx
  - medtriad/hooks/useStats.ts
autonomous: true

must_haves:
  truths:
    - "Home screen shows review indicator when triads are due (SR-01)"
    - "User can see how many triads are due for review (SR-07)"
    - "User can tap to enter Review Mode from home screen"
    - "Review button is disabled/hidden when no triads are due"
  artifacts:
    - path: "medtriad/components/home/ReviewDueBadge.tsx"
      provides: "Due triads indicator component"
      exports: ["ReviewDueBadge"]
    - path: "medtriad/components/home/ActionButtons.tsx"
      provides: "Action buttons with Review option"
      contains: "REVIEW"
    - path: "medtriad/app/(tabs)/index.tsx"
      provides: "Home screen with review integration"
      contains: "dueCount"
  key_links:
    - from: "medtriad/app/(tabs)/index.tsx"
      to: "medtriad/services/spaced-repetition.ts"
      via: "getDueTriadCount"
      pattern: "getDueTriadCount"
    - from: "medtriad/components/home/ReviewDueBadge.tsx"
      to: "expo-router"
      via: "router.push('/quiz/review')"
      pattern: "quiz/review"
---

<objective>
Integrate Review Mode into the home screen with a due triads indicator and Review action button.

Purpose: Users need to discover when triads are due for review and have an easy way to enter Review Mode. The indicator creates awareness; the button provides access.

Output: Home screen shows due count and provides one-tap access to Review Mode when triads are due.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-spaced-repetition/29-RESEARCH.md
@.planning/phases/29-spaced-repetition/29-01-SUMMARY.md

# Files to modify
@medtriad/components/home/ActionButtons.tsx
@medtriad/app/(tabs)/index.tsx
@medtriad/hooks/useStats.ts

# Design system reference
@medtriad/constants/theme.ts
@medtriad/components/primitives/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReviewDueBadge component</name>
  <files>medtriad/components/home/ReviewDueBadge.tsx</files>
  <action>
Create a new component that shows when triads are due for review (SR-01, SR-07).

**Props:**
```typescript
type ReviewDueBadgeProps = {
  dueCount: number;
  onPress: () => void;
};
```

**Behavior:**
- If dueCount === 0, return null (don't render anything)
- If dueCount > 0, render a tappable badge

**Design (following app's design system):**
- Use brand primary color for accent
- Rounded card style matching existing UI patterns
- Show Refresh icon from `@solar-icons/react-native/Bold`
- Text: "{dueCount} triad{dueCount !== 1 ? 's' : ''} due"
- Subtext: "Tap to review"

**Layout:**
```tsx
<Pressable onPress={onPress} style={styles.container}>
  <View style={styles.content}>
    <Icon icon={Refresh} size="md" color={theme.colors.brand.primary} />
    <View style={styles.textContainer}>
      <Text variant="label" weight="bold" color="primary">
        {dueCount} triad{dueCount !== 1 ? 's' : ''} due
      </Text>
      <Text variant="footnote" color="secondary">
        Tap to review
      </Text>
    </View>
  </View>
</Pressable>
```

**Styling:**
- Use theme.colors.surface.brand for background (light brand tint)
- Border: 2px brand.primary with 3px bottom border (brand.primaryDark) for depth
- borderRadius: Radius.lg
- padding: Spacing.md
- Match the elevated card style used elsewhere in the app
  </action>
  <verify>TypeScript compiles: `cd medtriad && npx tsc --noEmit`</verify>
  <done>ReviewDueBadge component renders due count with tap-to-review functionality, hidden when count is 0.</done>
</task>

<task type="auto">
  <name>Task 2: Add Review button to ActionButtons and wire up home screen</name>
  <files>medtriad/components/home/ActionButtons.tsx, medtriad/app/(tabs)/index.tsx, medtriad/hooks/useStats.ts</files>
  <action>
**Update ActionButtons.tsx:**

1. Add `onReview` and `dueCount` props:
```typescript
type ActionButtonsProps = {
  onStudy: () => void;
  onChallenge: () => void;
  onReview: () => void;
  dueCount: number;
  delay?: number;
};
```

2. Add a third ActionButton for Review:
- Icon: `Refresh` from `@solar-icons/react-native/Bold`
- Label: "REVIEW"
- Add badge showing due count if > 0 (small circle with number)
- onPress: calls `onReview`

3. Layout: Change from 2-button row to 3-button row (adjust flex to accommodate)
   OR stack as 2 rows: [Study, Challenge] and [Review] below if 3 don't fit well

4. If dueCount === 0, either:
   - Show Review button as disabled (opacity: 0.5, no onPress)
   - Or hide it entirely (simpler, less cluttered)

   Recommendation: Show disabled when 0, so users know the feature exists.

**Update useStats.ts:**

1. Add `dueCount` state: `const [dueCount, setDueCount] = useState(0);`

2. Import `getDueTriadCount` from `@/services/spaced-repetition`

3. In the refresh function (or a separate useEffect), call:
```typescript
getDueTriadCount().then(setDueCount).catch(() => setDueCount(0));
```

4. Return `dueCount` from the hook

**Update index.tsx (Home screen):**

1. Destructure `dueCount` from useStats()

2. Add `ReviewDueBadge` component between HeroCard and Start Quiz button:
```tsx
{dueCount > 0 && (
  <ReviewDueBadge
    dueCount={dueCount}
    onPress={() => router.push('/quiz/review')}
  />
)}
```

3. Update ActionButtons to pass new props:
```tsx
<ActionButtons
  onStudy={() => router.push('/quiz/study-filter')}
  onChallenge={handleChallenge}
  onReview={() => router.push('/quiz/review')}
  dueCount={dueCount}
  delay={Durations.stagger * 2.5}
/>
```

The ReviewDueBadge and ActionButtons provide two entry points to Review Mode - the badge is prominent when triads are due, and the button is always accessible.
  </action>
  <verify>App builds and home screen shows review indicator when triads are due</verify>
  <done>Home screen shows ReviewDueBadge when dueCount > 0, ActionButtons includes Review option, useStats returns dueCount.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd medtriad && npx tsc --noEmit`
2. Home screen shows ReviewDueBadge when triads are due (SR-01)
3. Badge displays correct count (SR-07)
4. Tapping badge navigates to /quiz/review
5. ActionButtons shows Review option
6. Review button disabled when dueCount is 0
</verification>

<success_criteria>
- ReviewDueBadge appears on home screen when triads are due (SR-01)
- Badge shows exact count of due triads (SR-07)
- Tapping badge or Review button navigates to Review Mode
- Review button is disabled/dimmed when no triads are due
- Due count refreshes when home screen gains focus
</success_criteria>

<output>
After completion, create `.planning/phases/29-spaced-repetition/29-03-SUMMARY.md`
</output>
