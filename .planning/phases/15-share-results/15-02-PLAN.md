---
phase: 15-share-results
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - medtriad/app/quiz/results.tsx
autonomous: true

must_haves:
  truths:
    - "User sees share button on Results screen with other action buttons"
    - "Tapping share generates image from hidden ShareCard and opens iOS share sheet"
    - "Share button shows loading state while sharing"
  artifacts:
    - path: "medtriad/app/quiz/results.tsx"
      provides: "Results screen with share integration"
      contains: "useShareCard"
  key_links:
    - from: "medtriad/app/quiz/results.tsx"
      to: "medtriad/components/share/ShareCard.tsx"
      via: "import and render in offscreen container"
      pattern: "ShareCard.*score.*correctCount"
    - from: "medtriad/app/quiz/results.tsx"
      to: "medtriad/hooks/useShareCard.ts"
      via: "hook usage for share action"
      pattern: "useShareCard"
---

<objective>
Integrate share functionality into the Results screen with share button and hidden capture card.

Purpose: Enable users to share their quiz results via the native iOS share sheet
Output: Working end-to-end share flow on Results screen
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/15-share-results/15-CONTEXT.md
@.planning/phases/15-share-results/15-RESEARCH.md
@.planning/phases/15-share-results/15-01-SUMMARY.md
@medtriad/app/quiz/results.tsx
@medtriad/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add share button to Results screen</name>
  <files>medtriad/app/quiz/results.tsx</files>
  <action>
    Modify the buttons section in results.tsx to add a Share button:

    **Current button order:**
    1. Play Again (primary)
    2. Home (secondary)

    **New button order (per CONTEXT.md - share with action buttons):**
    1. Play Again (primary)
    2. Share (secondary) - NEW
    3. Home (secondary)

    **Share button props:**
    ```typescript
    <Button
      label={isSharing ? 'Sharing...' : 'Share'}
      variant="secondary"
      onPress={share}
      disabled={isSharing}
    />
    ```

    **Import useShareCard:**
    ```typescript
    import { useShareCard } from '@/hooks/useShareCard';
    ```

    **In component:**
    ```typescript
    const { cardRef, share, isSharing } = useShareCard();
    ```

    Note: The button text changes to "Sharing..." during the share operation to provide feedback.
  </action>
  <verify>
    Run `grep -n "Share" medtriad/app/quiz/results.tsx` and confirm:
    - useShareCard import exists
    - Button with label containing "Share" exists
    - isSharing is used for disabled state
  </verify>
  <done>
    Share button appears between Play Again and Home buttons with loading state support
  </done>
</task>

<task type="auto">
  <name>Task 2: Add hidden ShareCard for capture</name>
  <files>medtriad/app/quiz/results.tsx</files>
  <action>
    Add the hidden ShareCard component for capture below the visible UI:

    **Import ShareCard:**
    ```typescript
    import { ShareCard } from '@/components/share/ShareCard';
    ```

    **Add hidden container after the buttons View, before ConfettiCannon:**
    ```typescript
    {/* Hidden share card for capture */}
    <View style={styles.offscreen}>
      <View ref={cardRef} collapsable={false}>
        <ShareCard
          score={score}
          correctCount={correctCount}
          totalQuestions={QUESTION_COUNT}
        />
      </View>
    </View>
    ```

    **Add offscreen style:**
    ```typescript
    offscreen: {
      position: 'absolute',
      left: -9999,
      top: 0,
    },
    ```

    **Critical details:**
    - Position absolute with left: -9999 hides card off-screen
    - The ref wrapper View needs collapsable={false} (Android capture fix)
    - ShareCard receives the same score/correctCount from route params
    - QUESTION_COUNT is already imported from types/quiz-state
  </action>
  <verify>
    Run `grep -A5 "offscreen" medtriad/app/quiz/results.tsx` and confirm:
    - offscreen style exists with position: absolute, left: -9999
    - ShareCard is rendered with score, correctCount, totalQuestions props
    - cardRef is attached to wrapper View
    - collapsable={false} is set
  </verify>
  <done>
    Hidden ShareCard renders off-screen and is wired to cardRef for capture
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. App builds without errors: `cd medtriad && npx expo start --ios` (no red screens)
2. Results screen shows Share button between Play Again and Home
3. Tapping Share:
   - Button shows "Sharing..." state
   - iOS share sheet opens with image preview
   - Image shows mascot, headline, score, correct count, branding
4. Can dismiss share sheet and button returns to "Share" state
</verification>

<success_criteria>
- Share button visible on Results screen
- Share button has loading state during share operation
- Hidden ShareCard renders off-screen
- Tapping Share opens native iOS share sheet with generated image
- Share card image contains: mascot, performance headline, score, correct count, MedTriads branding
</success_criteria>

<output>
After completion, create `.planning/phases/15-share-results/15-02-SUMMARY.md`
</output>
