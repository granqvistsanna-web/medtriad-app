---
phase: 15-share-results
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - medtriad/package.json
  - medtriad/components/share/ShareCard.tsx
  - medtriad/hooks/useShareCard.ts
autonomous: true

must_haves:
  truths:
    - "ShareCard renders mascot, headline, score, correct count, and branding"
    - "useShareCard hook captures a ref and returns share function"
    - "Dependencies for view capture and native sharing are installed"
  artifacts:
    - path: "medtriad/components/share/ShareCard.tsx"
      provides: "Visual share card component"
      exports: ["ShareCard"]
    - path: "medtriad/hooks/useShareCard.ts"
      provides: "Capture and share logic hook"
      exports: ["useShareCard"]
  key_links:
    - from: "medtriad/hooks/useShareCard.ts"
      to: "react-native-view-shot"
      via: "captureRef import"
      pattern: "captureRef.*react-native-view-shot"
    - from: "medtriad/hooks/useShareCard.ts"
      to: "expo-sharing"
      via: "Sharing import"
      pattern: "Sharing.*expo-sharing"
---

<objective>
Create the core share infrastructure: dependencies, ShareCard visual component, and useShareCard hook.

Purpose: Establish the foundation for capturing and sharing quiz results as an image
Output: ShareCard component and useShareCard hook ready for Results screen integration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-share-results/15-CONTEXT.md
@.planning/phases/15-share-results/15-RESEARCH.md
@medtriad/constants/theme.ts
@medtriad/app/quiz/results.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install share dependencies</name>
  <files>medtriad/package.json</files>
  <action>
    Install react-native-view-shot and expo-sharing:
    ```bash
    cd medtriad && npx expo install react-native-view-shot expo-sharing
    ```

    These are required for:
    - react-native-view-shot: Capture React Native views as images
    - expo-sharing: Native iOS share sheet integration
  </action>
  <verify>
    Run `cat medtriad/package.json | grep -E "react-native-view-shot|expo-sharing"` and confirm both appear in dependencies
  </verify>
  <done>
    package.json includes react-native-view-shot and expo-sharing as dependencies
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ShareCard component</name>
  <files>medtriad/components/share/ShareCard.tsx</files>
  <action>
    Create `medtriad/components/share/ShareCard.tsx` with:

    **Props interface:**
    ```typescript
    type ShareCardProps = {
      score: number;
      correctCount: number;
      totalQuestions: number;
    };
    ```

    **Layout (per CONTEXT.md - mascot as hero):**
    - Fixed dimensions: 360x450 (will capture at device pixel ratio)
    - Top section: Performance headline (dynamic based on accuracy)
    - Center: tri-share.png mascot image (160px, centered)
    - Below mascot: Score as large bold number (no "points" label)
    - Below score: "X/Y correct" text
    - Bottom: "MedTriads" branding bar

    **Headline logic (from results.tsx getResultMessage):**
    - 100% accuracy: "Perfect!"
    - 90%+: "Incredible!"
    - 70%+: "Great job!"
    - 50%+: "Good effort!"
    - Below 50%: "Keep practicing!"

    **Styling (from theme.ts):**
    - Background: White (#FFFFFF) - avoid gradients for reliable capture
    - Headline: Typography.titleLarge, colors.text
    - Score: Typography.display (fontSize 56), colors.primary
    - Correct count: Typography.body, colors.textSecondary
    - Branding bar: colors.primaryLight background, colors.primary text

    **Critical for capture:**
    - Use `collapsable={false}` on main View
    - Use static `require()` for mascot image (already available)
    - Use solid background, not LinearGradient (more reliable capture)
    - Fixed pixel dimensions for consistent output

    Static mascot require:
    ```typescript
    const triShare = require('@/assets/images/tri-share.png');
    ```
  </action>
  <verify>
    Run `cat medtriad/components/share/ShareCard.tsx` and confirm:
    - Component exports ShareCard
    - Uses collapsable={false}
    - Has fixed width/height
    - Static require for tri-share.png
    - Displays score, correctCount, headline, mascot, branding
  </verify>
  <done>
    ShareCard component renders all required elements with correct styling and capture-safe patterns
  </done>
</task>

<task type="auto">
  <name>Task 3: Create useShareCard hook</name>
  <files>medtriad/hooks/useShareCard.ts</files>
  <action>
    Create `medtriad/hooks/useShareCard.ts`:

    **Hook interface:**
    ```typescript
    export function useShareCard(): {
      cardRef: React.RefObject<View>;
      share: () => Promise<void>;
      isSharing: boolean;
    };
    ```

    **Implementation:**
    1. Create ref with `useRef<View>(null)`
    2. Track isSharing state with `useState(false)`
    3. Create share function with `useCallback`:
       - Guard: return early if no ref or already sharing
       - Set isSharing true
       - Call `captureRef(cardRef, { format: 'png', quality: 1, result: 'tmpfile' })`
       - Check `Sharing.isAvailableAsync()` before sharing
       - Call `Sharing.shareAsync(uri, { mimeType: 'image/png' })`
       - Wrap in try/catch, always set isSharing false in finally

    **Imports:**
    ```typescript
    import { useRef, useState, useCallback } from 'react';
    import { View } from 'react-native';
    import { captureRef } from 'react-native-view-shot';
    import * as Sharing from 'expo-sharing';
    ```

    **Error handling:**
    - Log errors to console.error('Share failed:', error)
    - Don't throw - silently fail and reset isSharing

    Note: No UI feedback for share failure in this plan. The isSharing state provides loading indication.
  </action>
  <verify>
    Run `cat medtriad/hooks/useShareCard.ts` and confirm:
    - Exports useShareCard function
    - Returns { cardRef, share, isSharing }
    - Imports captureRef from react-native-view-shot
    - Imports Sharing from expo-sharing
    - Uses isAvailableAsync check
    - Has try/catch with finally
  </verify>
  <done>
    useShareCard hook provides cardRef, share function, and isSharing state
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Package dependencies installed: `npm ls react-native-view-shot expo-sharing` returns valid versions
2. ShareCard component exists with correct exports
3. useShareCard hook exists with correct exports
4. No TypeScript errors: `cd medtriad && npx tsc --noEmit` (check share-related files)
</verification>

<success_criteria>
- react-native-view-shot and expo-sharing in package.json
- ShareCard.tsx renders mascot-centric share card with headline, score, correct count, branding
- useShareCard.ts provides capture/share functionality with loading state
- Components follow project conventions (theme tokens, existing patterns)
</success_criteria>

<output>
After completion, create `.planning/phases/15-share-results/15-01-SUMMARY.md`
</output>
