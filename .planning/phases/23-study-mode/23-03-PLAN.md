---
phase: 23-study-mode
plan: 03
type: execute
wave: 3
depends_on: ["23-02"]
files_modified:
  - medtriad/app/quiz/study-results.tsx
  - medtriad/components/progress/TrickyQuestionsList.tsx
  - medtriad/app/(tabs)/progress.tsx
  - medtriad/app/(tabs)/index.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "User can tap Study button on Home to start study session"
    - "User sees session summary after completing study mode"
    - "User can view tricky questions list from Progress screen"
    - "Tricky questions list shows marked triads with category"
  artifacts:
    - path: "medtriad/app/quiz/study-results.tsx"
      provides: "Study session summary screen"
      min_lines: 50
    - path: "medtriad/components/progress/TrickyQuestionsList.tsx"
      provides: "Tricky questions display component"
      exports: ["TrickyQuestionsList"]
    - path: "medtriad/app/(tabs)/progress.tsx"
      provides: "Progress screen with tricky questions section"
      contains: "TrickyQuestionsList"
    - path: "medtriad/app/(tabs)/index.tsx"
      provides: "Home screen with Study button wired"
      contains: "/quiz/study"
  key_links:
    - from: "medtriad/app/(tabs)/index.tsx"
      to: "medtriad/app/quiz/study.tsx"
      via: "router.push('/quiz/study')"
      pattern: "router\\.push.*quiz/study"
    - from: "medtriad/components/progress/TrickyQuestionsList.tsx"
      to: "medtriad/services/study-storage.ts"
      via: "loadTrickyQuestions"
      pattern: "loadTrickyQuestions"
---

<objective>
Complete Study Mode integration: results screen, tricky questions list, and entry point wiring.

Purpose: Connect all Study Mode pieces together so users can start study sessions from Home, see their results, and review their tricky questions from the Progress screen.

Output: Study results screen, TrickyQuestionsList component, updated Progress screen, and Home screen with Study button wired to /quiz/study.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-study-mode/23-RESEARCH.md
@.planning/phases/23-study-mode/23-01-SUMMARY.md
@.planning/phases/23-study-mode/23-02-SUMMARY.md

Reference existing patterns:
@medtriad/app/quiz/results.tsx
@medtriad/app/(tabs)/progress.tsx
@medtriad/app/(tabs)/index.tsx
@medtriad/components/progress/QuizHistoryList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Study Results Screen</name>
  <files>medtriad/app/quiz/study-results.tsx</files>
  <action>
Create a study session summary screen that shows after completing study mode.

Route params (from study.tsx navigation):
- correctCount: string
- totalQuestions: string
- trickyCount: string

Structure:
1. SafeAreaView with theme.colors.surface.primary background

2. Hero section (centered):
   - "Session Complete" heading (Text variant="title")
   - Large score display: "{correctCount}/{totalQuestions}" with blue accent
   - Subtitle: "questions answered correctly"

3. Stats row (if trickyCount > 0):
   - "Marked {trickyCount} as tricky" with bookmark icon

4. Action buttons:
   - Primary: "Study Again" -> router.replace('/quiz/study')
   - Secondary: "Back to Home" -> router.replace('/')

Styling:
- Use blue color family for accents (consistent with study mode theme)
- Calm, encouraging tone (no scores, no high score tracking)
- Similar layout to existing results.tsx but simpler (no tier-up, no score breakdown)

Animation:
- FadeIn for hero section
- FadeInUp with stagger for stats and buttons

No tier progression, no high score check, no points - this is for learning, not competition.

Export default: export default function StudyResultsScreen
  </action>
  <verify>
    - File exists at medtriad/app/quiz/study-results.tsx
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - Route params are parsed correctly
    - No scoring/tier logic
  </verify>
  <done>Study results screen shows session summary with calm blue theme</done>
</task>

<task type="auto">
  <name>Task 2: Create Tricky Questions List Component</name>
  <files>medtriad/components/progress/TrickyQuestionsList.tsx</files>
  <action>
Create a component to display the user's tricky questions on the Progress screen.

Props:
- none (loads data internally via useFocusEffect)

Internal state:
- trickyQuestions: TrickyQuestion[] (from study-storage)
- loading: boolean

Behavior:
1. On mount and focus: loadTrickyQuestions()
2. Match triadIds to actual triads via getAllTriads() from @/services/triads
3. Display list of tricky triads

Structure:
1. Section header: "Tricky Questions" with Text variant="heading"
   - Optional: small badge showing count

2. If empty: Show helpful message
   - "No tricky questions yet"
   - "Mark questions during Study Mode to review them here"

3. If has items: FlashList or simple map (likely < 50 items)
   - Each item shows:
     - Condition name (Text variant="body", weight="semibold")
     - Category badge (Text variant="tiny", color based on category)
     - Findings preview (Text variant="caption", color="secondary", numberOfLines=1)
   - Optional: "Remove" button (X icon) to unmark as tricky

Item styling:
- Card-like appearance with light background
- Blue accent for bookmark icon
- Spacing between items

Use TriadCard if it fits, or create simpler inline item.

Import: loadTrickyQuestions, removeTrickyQuestion from @/services/study-storage
Import: getAllTriads from @/services/triads
Import: FlashList from @shopify/flash-list (if list could grow)

Export named: export function TrickyQuestionsList
  </action>
  <verify>
    - File exists at medtriad/components/progress/TrickyQuestionsList.tsx
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - Loads tricky questions on mount
    - Handles empty state
  </verify>
  <done>TrickyQuestionsList displays marked tricky questions with empty state</done>
</task>

<task type="auto">
  <name>Task 3: Wire Entry Points</name>
  <files>medtriad/app/(tabs)/progress.tsx, medtriad/app/(tabs)/index.tsx</files>
  <action>
PART A - Update Progress Screen:

Add TrickyQuestionsList to the Progress screen.

1. Import TrickyQuestionsList from @/components/progress/TrickyQuestionsList

2. Add section after Quiz History:
   - Wrap in Animated.View with FadeInUp (staggered delay after history)
   - Render <TrickyQuestionsList />

3. Add section header before the list (similar pattern to "YOUR STATS"):
   - Text variant="tiny", color="muted", "STUDY MODE" or "FOR REVIEW"
   - Divider line

The TrickyQuestionsList component handles its own loading and empty state.

---

PART B - Update Home Screen:

Change the Study button to navigate to /quiz/study instead of /library.

1. Find the ActionButtons component usage
2. Change: onStudy={() => router.push('/library')}
   To: onStudy={() => router.push('/quiz/study')}

That's it - the ActionButtons component already has the Study button with Book icon.
The label "STUDY" already exists.

This satisfies SM-01: "Study Mode entry point visible on Home screen"

---

Export requirements unchanged (both files already have default exports).
  </action>
  <verify>
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - Home screen Study button navigates to /quiz/study
    - Progress screen imports and renders TrickyQuestionsList
    - grep confirms: router.push.*quiz/study in index.tsx
  </verify>
  <done>Study Mode accessible from Home, tricky questions visible in Progress</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. TypeScript compiles: `cd medtriad && npx tsc --noEmit`
2. App starts without errors: `cd medtriad && npx expo start`
3. Full flow test:
   - Tap "STUDY" on Home -> navigates to /quiz/study
   - Complete study session -> navigates to study-results
   - Tap "Back to Home" -> returns to Home
   - Go to Progress -> see TrickyQuestionsList section
</verification>

<success_criteria>
- User can start study session from Home screen Study button
- Study results screen displays session summary
- Progress screen shows tricky questions section
- Tricky questions list shows marked items or empty state
- Full study flow works end-to-end
</success_criteria>

<checkpoint type="human-verify" gate="blocking">
  <what-built>Complete Study Mode feature with all screens and integrations</what-built>
  <how-to-verify>
    1. Start the app: `cd medtriad && npx expo start`
    2. On Home screen, tap "STUDY" button
    3. Verify: Navigates to study mode (no timer visible)
    4. Answer a few questions:
       - Verify explanation card appears after each answer
       - Verify "Mark as tricky" button is visible
       - Mark at least one question as tricky
    5. Complete the session (10 questions)
    6. Verify: Study results screen shows correct count and tricky count
    7. Tap "Back to Home"
    8. Navigate to Progress tab
    9. Scroll down to see "Tricky Questions" section
    10. Verify: Marked question(s) appear in the list

    Visual checks:
    - Study mode has calm blue accents (not wine/brand)
    - No timer bar in study mode
    - Explanation card has blue background
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</checkpoint>

<output>
After completion, create `.planning/phases/23-study-mode/23-03-SUMMARY.md`
</output>
