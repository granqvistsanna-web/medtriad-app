---
phase: 23-study-mode
plan: 02
type: execute
wave: 2
depends_on: ["23-01"]
files_modified:
  - medtriad/app/quiz/study.tsx
  - medtriad/components/quiz/ExplanationCard.tsx
  - medtriad/components/quiz/TrickyButton.tsx
  - medtriad/components/quiz/StudyHeader.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can complete a study session without time pressure"
    - "User sees explanation card after answering each question"
    - "User can mark questions as tricky during the session"
    - "Study mode has a calm blue visual theme distinct from timed quiz"
    - "Progress shows X of Y questions completed"
  artifacts:
    - path: "medtriad/app/quiz/study.tsx"
      provides: "Study mode screen"
      min_lines: 100
    - path: "medtriad/components/quiz/ExplanationCard.tsx"
      provides: "Explanation display component"
      exports: ["ExplanationCard"]
    - path: "medtriad/components/quiz/TrickyButton.tsx"
      provides: "Mark as tricky toggle button"
      exports: ["TrickyButton"]
    - path: "medtriad/components/quiz/StudyHeader.tsx"
      provides: "Study mode header without timer"
      exports: ["StudyHeader"]
  key_links:
    - from: "medtriad/app/quiz/study.tsx"
      to: "medtriad/hooks/use-study-reducer.ts"
      via: "useStudyReducer hook"
      pattern: "useStudyReducer"
    - from: "medtriad/app/quiz/study.tsx"
      to: "medtriad/services/study-storage.ts"
      via: "toggleTrickyQuestion call"
      pattern: "toggleTrickyQuestion"
    - from: "medtriad/app/quiz/study.tsx"
      to: "medtriad/components/quiz/ExplanationCard.tsx"
      via: "ExplanationCard component"
      pattern: "<ExplanationCard"
---

<objective>
Build the Study Mode screen and supporting components for untimed quiz practice.

Purpose: Create the core user experience for Study Mode - a relaxed quiz flow where users answer questions without time pressure, see explanations after each answer, and can mark questions as tricky for later review.

Output: Study mode screen at /quiz/study route with calm blue theme, plus ExplanationCard, TrickyButton, and StudyHeader components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-study-mode/23-RESEARCH.md
@.planning/phases/23-study-mode/23-01-SUMMARY.md

Reference existing patterns:
@medtriad/app/quiz/index.tsx
@medtriad/components/quiz/FindingsCard.tsx
@medtriad/components/quiz/AnswerCard.tsx
@medtriad/constants/tokens/colors.ts
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Study Header Component</name>
  <files>medtriad/components/quiz/StudyHeader.tsx</files>
  <action>
Create a header component for Study Mode that shows progress without timer.

Props:
- currentIndex: number (0-based)
- totalQuestions: number
- onCancel: () => void

Structure:
1. Container row with flexDirection: 'row', justifyContent: 'space-between'
2. Left: CancelButton (reuse existing from @/components/quiz/CancelButton)
3. Center: Progress text "X of Y" using Text primitive with variant="footnote", color="muted"
4. Right: Empty View for balance (or subtle "STUDY" label with blue color)

Styling:
- Use theme.colors.blue.main for any accent (distinguish from timed mode)
- Use existing Spacing tokens for padding
- Border bottom like timed quiz header

Add subtle "STUDY MODE" badge in header:
- Small Text with variant="tiny", color={theme.colors.blue.main}
- Or omit if too cluttered - just the progress is fine

Export named: export function StudyHeader
  </action>
  <verify>
    - File exists at medtriad/components/quiz/StudyHeader.tsx
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - No timer-related props or logic
  </verify>
  <done>StudyHeader displays progress without timer, uses calm blue accent</done>
</task>

<task type="auto">
  <name>Task 2: Create Explanation Card Component</name>
  <files>medtriad/components/quiz/ExplanationCard.tsx</files>
  <action>
Create ExplanationCard to display after user answers a question.

Props:
- triad: Triad (from @/types)

Structure (using Card primitive):
1. Category label: Text variant="tiny", color={theme.colors.blue.text}, uppercase, letterSpacing: 1
2. Condition name: Text variant="heading", color="primary", weight="semibold"
3. Findings summary: Text variant="body", color="secondary"
   - Format as: "Classic triad: {finding1}, {finding2}, {finding3}"

Styling:
- Use Card primitive as container
- Background: theme.colors.blue[100] (light teal: #E8F4F3)
- Border: theme.colors.blue[500] (main teal: #5BA9A2)
- Border bottom: theme.colors.blue[600] for 3D depth (like AnswerCard pattern)
- Padding: Spacing.md

Animation:
- Wrap in Animated.View with FadeInUp entrance animation
- Duration: Durations.normal

Note: For MVP, we use the triad's existing data (condition + findings) as the "explanation".
Real explanations can be added to triads.json in a future phase.

Export named: export function ExplanationCard
  </action>
  <verify>
    - File exists at medtriad/components/quiz/ExplanationCard.tsx
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - Uses blue color family (not wine/brand)
    - Displays condition and findings
  </verify>
  <done>ExplanationCard shows triad info with calm blue styling after answer</done>
</task>

<task type="auto">
  <name>Task 3: Create Tricky Button Component and Study Screen</name>
  <files>medtriad/components/quiz/TrickyButton.tsx, medtriad/app/quiz/study.tsx</files>
  <action>
PART A - TrickyButton Component:

Create toggle button for marking questions as tricky.

Props:
- isMarked: boolean
- onToggle: () => void

Structure:
1. Pressable container with row layout
2. Icon: Bookmark from @solar-icons/react-native/Bold (or BookmarkBoldDuotone)
   - If marked: filled/solid, color={theme.colors.warning.main}
   - If not marked: outline style, color={theme.colors.text.secondary}
3. Text label:
   - If marked: "Marked as tricky", color={theme.colors.warning.text}
   - If not marked: "Mark as tricky", color="secondary"

Styling:
- Use Spacing tokens for padding and gap
- borderRadius: Radius.md
- Light background on press (activeOpacity pattern or Pressable style)

Haptic: Call useHaptics().triggerHaptic() on toggle

Export named: export function TrickyButton

---

PART B - Study Screen:

Create the main study mode screen at app/quiz/study.tsx.

Imports needed:
- useStudyReducer from @/hooks/use-study-reducer
- toggleTrickyQuestion, saveStudySession from @/services/study-storage
- StudyHeader, ExplanationCard, TrickyButton (new components)
- FindingsCard, AnswerCard, CancelButton (existing)
- generateQuestionSet from @/services/question-generator
- useRouter from expo-router
- useHaptics, useSoundEffects (existing hooks)
- STUDY_QUESTION_COUNT from @/types/study-state

Screen structure:

1. Initialize: useEffect to generate questions and dispatch START_STUDY

2. Header: StudyHeader with progress (no timer)

3. Main content (ScrollView or View):
   - FindingsCard (reuse existing)
   - Answer cards (map over options, use AnswerCard)
   - ExplanationCard (shown when status === 'answered')
   - Footer with TrickyButton + Continue button (shown when status === 'answered')

4. Answer selection handler:
   - triggerHaptic()
   - dispatch SELECT_ANSWER
   - playSound (correct/incorrect)
   - No auto-advance (unlike timed quiz) - user taps Continue

5. Continue handler:
   - If more questions: dispatch NEXT_QUESTION
   - If last question:
     - Save study session via saveStudySession()
     - Navigate to results: router.replace('/quiz/study-results')

6. Tricky toggle handler:
   - dispatch TOGGLE_TRICKY
   - toggleTrickyQuestion(triadId, category) - fire and forget async

7. getAnswerState function (same pattern as timed quiz)

Styling differences from timed quiz:
- No TimerBar component
- Background can be same surface.primary
- Use blue accents where timed uses wine/brand
- More relaxed spacing (optional)

Pass to results via router params:
- correctCount, totalQuestions, trickyCount

Export default: export default function StudyScreen
  </action>
  <verify>
    - Files exist: medtriad/components/quiz/TrickyButton.tsx, medtriad/app/quiz/study.tsx
    - TypeScript compiles: `cd medtriad && npx tsc --noEmit`
    - Study screen has no timer logic (grep for 'timer', 'Timer', 'TICK')
    - TrickyButton toggles visual state
    - ExplanationCard shown after answer
  </verify>
  <done>Study screen provides untimed quiz flow with explanation display and tricky marking</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. TypeScript compiles: `cd medtriad && npx tsc --noEmit`
2. App starts: `cd medtriad && npx expo start` (check for runtime errors)
3. Navigate to /quiz/study route (via code or direct URL)
4. No timer visible in study mode
5. Explanation card appears after answering
6. Tricky button is visible and toggleable
</verification>

<success_criteria>
- Study mode screen loads without errors at /quiz/study
- Questions display without time pressure
- ExplanationCard appears after each answer with blue styling
- TrickyButton toggles between marked/unmarked states
- Continue button advances to next question
- Session completes and navigates to results
</success_criteria>

<output>
After completion, create `.planning/phases/23-study-mode/23-02-SUMMARY.md`
</output>
