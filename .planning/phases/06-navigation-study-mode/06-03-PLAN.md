# Plan 06-03: Progress Screen with Stats and History

---
phase: 06-navigation-study-mode
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - medtriad/app/(tabs)/progress.tsx
  - medtriad/services/stats-storage.ts
  - medtriad/components/progress/StatsCard.tsx
  - medtriad/components/progress/QuizHistoryList.tsx
autonomous: true

must_haves:
  truths:
    - "User sees detailed stats (accuracy, total correct, high score)"
    - "User sees quiz history with recent rounds"
    - "Stats load from persisted storage"
    - "History shows date, score, and accuracy for each round"
  artifacts:
    - path: "medtriad/app/(tabs)/progress.tsx"
      provides: "Progress screen with stats and history"
      min_lines: 50
    - path: "medtriad/services/stats-storage.ts"
      provides: "Quiz history storage functions"
      contains: "quizHistory|QuizHistoryEntry"
    - path: "medtriad/components/progress/StatsCard.tsx"
      provides: "Stats display card"
      exports: ["StatsCard"]
    - path: "medtriad/components/progress/QuizHistoryList.tsx"
      provides: "Recent quiz rounds list"
      exports: ["QuizHistoryList"]
  key_links:
    - from: "medtriad/app/(tabs)/progress.tsx"
      to: "@/services/stats-storage"
      via: "loadStats and loadQuizHistory imports"
      pattern: "loadStats|loadQuizHistory"
    - from: "medtriad/app/quiz/results.tsx"
      to: "@/services/stats-storage"
      via: "saveQuizHistory call"
      pattern: "saveQuizHistory"
---

<objective>
Build the Progress screen showing detailed statistics and quiz history.

Purpose: Help users track their learning progress and review past performance.
Output: Progress screen with stats cards and scrollable quiz history.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-navigation-study-mode/06-CONTEXT.md
@.planning/phases/06-navigation-study-mode/06-RESEARCH.md

# Existing code references
@medtriad/services/stats-storage.ts
@medtriad/app/quiz/results.tsx
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend stats-storage with quiz history</name>
  <files>medtriad/services/stats-storage.ts</files>
  <action>
Add quiz history tracking to the existing stats storage.

1. Add QuizHistoryEntry interface:
```tsx
export interface QuizHistoryEntry {
  date: string;          // ISO date string
  score: number;         // Final score
  correct: number;       // Questions answered correctly
  total: number;         // Total questions (always 10)
}
```

2. Add HISTORY_KEY constant: `'@medtriad_quiz_history'`

3. Add MAX_HISTORY_ENTRIES constant: 50 (per research pitfall 6)

4. Add loadQuizHistory function:
```tsx
export async function loadQuizHistory(): Promise<QuizHistoryEntry[]> {
  try {
    const json = await AsyncStorage.getItem(HISTORY_KEY);
    if (json) return JSON.parse(json);
    return [];
  } catch (error) {
    console.error('Failed to load quiz history:', error);
    return [];
  }
}
```

5. Add saveQuizHistory function that:
   - Loads existing history
   - Prepends new entry (most recent first)
   - Limits to MAX_HISTORY_ENTRIES
   - Saves back to AsyncStorage

```tsx
export async function saveQuizHistory(entry: QuizHistoryEntry): Promise<void> {
  try {
    const history = await loadQuizHistory();
    const updated = [entry, ...history].slice(0, MAX_HISTORY_ENTRIES);
    await AsyncStorage.setItem(HISTORY_KEY, JSON.stringify(updated));
  } catch (error) {
    console.error('Failed to save quiz history:', error);
  }
}
```

6. Update clearStats to also clear history (call AsyncStorage.removeItem for HISTORY_KEY).
  </action>
  <verify>Functions export correctly. Types compile without errors.</verify>
  <done>Quiz history storage functions added: loadQuizHistory, saveQuizHistory, QuizHistoryEntry type.</done>
</task>

<task type="auto">
  <name>Task 2: Create Progress screen components</name>
  <files>medtriad/components/progress/StatsCard.tsx, medtriad/components/progress/QuizHistoryList.tsx</files>
  <action>
Create two components for the Progress screen.

**StatsCard.tsx:**
Displays a single stat with label and value.

Props:
```tsx
interface StatsCardProps {
  label: string;
  value: string | number;
  icon?: string;  // SF Symbol name (optional)
}
```

Implementation:
- Card with colors.backgroundCard background, Shadows.light.sm shadow
- Icon (if provided) using IconSymbol, colors.primary
- Value using Typography.stat, colors.text
- Label using Typography.caption, colors.textSecondary
- Radius.md border radius

**QuizHistoryList.tsx:**
Displays list of recent quiz rounds.

Props:
```tsx
interface QuizHistoryListProps {
  history: QuizHistoryEntry[];
}
```

Implementation:
- Section title "Recent Quizzes" using Typography.heading
- If empty, show "No quizzes yet" message
- Map history entries to rows showing:
  - Date (format: "Jan 18" using toLocaleDateString with month: 'short', day: 'numeric')
  - Score (right-aligned)
  - Accuracy as X/10 (subtitle)
- Use FlatList with keyExtractor based on date+index
- Rows have border bottom separator
  </action>
  <verify>Components render without errors when imported.</verify>
  <done>StatsCard and QuizHistoryList components created with proper typing and styling.</done>
</task>

<task type="auto">
  <name>Task 3: Wire Progress screen and history saving</name>
  <files>medtriad/app/(tabs)/progress.tsx, medtriad/app/quiz/results.tsx</files>
  <action>
**Progress screen (progress.tsx):**
Replace placeholder with full implementation.

1. Load stats using loadStats() in useEffect on mount
2. Load history using loadQuizHistory() in useEffect on mount
3. Track loading state, show placeholder while loading
4. Calculate derived stats:
   - accuracy: getAccuracy(stats)
   - avgScore: stats.gamesPlayed > 0 ? Math.round(stats.totalAnswered / stats.gamesPlayed * 10) : 0
     (Actually use: total score isn't tracked, so just show accuracy)

Layout (ScrollView):
- Title "Progress" at top
- Stats grid (2 columns, 2 rows):
  - High Score (trophy icon)
  - Accuracy % (percent icon: "percent")
  - Games Played (gamecontroller icon: "gamecontroller")
  - Best Streak (flame icon: "flame")
- QuizHistoryList below stats grid

Use useFocusEffect from @react-navigation/native to reload data when tab becomes focused.

**Results screen (results.tsx):**
Add quiz history save when quiz completes.

1. Import saveQuizHistory from @/services/stats-storage
2. In the existing useEffect that runs after quiz ends, add:
```tsx
saveQuizHistory({
  date: new Date().toISOString(),
  score: parseInt(score),
  correct: parseInt(correct),
  total: QUESTION_COUNT,
});
```
  </action>
  <verify>
Run `npx expo start`:
- Navigate to Progress tab - shows stats (may be 0 initially)
- Play a quiz round
- Return to Progress tab - should show updated stats and quiz in history
- History shows date, score, accuracy for the round just played
  </verify>
  <done>Progress screen displays stats and history. Quiz history saves after each round.</done>
</task>

</tasks>

<verification>
- [ ] Progress tab shows high score, accuracy, games played, best streak
- [ ] Stats reload when returning to Progress tab
- [ ] Quiz history appears after completing a round
- [ ] History limited to 50 entries (test by checking storage logic)
- [ ] Empty state shown when no quizzes completed
- [ ] No TypeScript errors (`npx tsc --noEmit`)
</verification>

<success_criteria>
Progress screen enables users to:
- View overall stats (high score, accuracy, games played, best streak)
- Review recent quiz history with date, score, and accuracy per round
- See updated stats immediately after completing a quiz
</success_criteria>

<output>
After completion, create `.planning/phases/06-navigation-study-mode/06-03-SUMMARY.md`
</output>
