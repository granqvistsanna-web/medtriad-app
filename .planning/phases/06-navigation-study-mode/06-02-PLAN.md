# Plan 06-02: Library Screen with Triad Browsing

---
phase: 06-navigation-study-mode
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - medtriad/app/(tabs)/library.tsx
  - medtriad/components/library/CategorySection.tsx
  - medtriad/components/library/TriadItem.tsx
autonomous: true

must_haves:
  truths:
    - "User can browse all triads grouped by medical category"
    - "User can tap a triad to view condition name and all three findings"
    - "Categories collapse/expand when tapped"
    - "Triads expand inline to show findings"
  artifacts:
    - path: "medtriad/app/(tabs)/library.tsx"
      provides: "Library screen with category list"
      min_lines: 40
    - path: "medtriad/components/library/CategorySection.tsx"
      provides: "Collapsible category header with triad list"
      exports: ["CategorySection"]
    - path: "medtriad/components/library/TriadItem.tsx"
      provides: "Expandable triad row showing findings"
      exports: ["TriadItem"]
  key_links:
    - from: "medtriad/app/(tabs)/library.tsx"
      to: "@/services/triads"
      via: "getTriadsByCategory import"
      pattern: "getTriadsByCategory"
    - from: "medtriad/components/library/CategorySection.tsx"
      to: "medtriad/components/library/TriadItem.tsx"
      via: "TriadItem import and render"
      pattern: "<TriadItem"
---

<objective>
Build the Library screen where users can browse all medical triads organized by category.

Purpose: Enable study mode - users can review triads outside the quiz to learn and reinforce knowledge.
Output: Functional Library screen with collapsible category sections and expandable triad items.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-navigation-study-mode/06-CONTEXT.md
@.planning/phases/06-navigation-study-mode/06-RESEARCH.md

# Existing code references
@medtriad/services/triads.ts
@medtriad/types/triad.ts
@medtriad/constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TriadItem component</name>
  <files>medtriad/components/library/TriadItem.tsx</files>
  <action>
Create an expandable triad item component that shows condition name and expands to show all three findings.

Props interface:
```tsx
interface TriadItemProps {
  triad: Triad;
}
```

Implementation:
1. Create component showing triad condition name
2. Track `isExpanded` state (default false)
3. On tap, toggle `isExpanded`
4. When expanded, show all three findings below condition name
5. Use Reanimated for smooth height animation (follow research Pattern 5)
6. Show chevron icon that rotates when expanded (chevron.down / chevron.up via IconSymbol)

Styling:
- Condition name: Typography.body, colors.text
- Findings: Typography.caption, colors.textSecondary, left padding for indent
- Border bottom for separation
- Tap feedback via Pressable with opacity

Note: The accordion height animation requires measuring content height. Use the pattern from research where content is position: absolute for measurement, then animated container clips it.
  </action>
  <verify>Component imports without errors. Test in isolation if needed by temporarily adding to library screen.</verify>
  <done>TriadItem component shows condition name, expands/collapses to reveal findings with smooth animation.</done>
</task>

<task type="auto">
  <name>Task 2: Create CategorySection component</name>
  <files>medtriad/components/library/CategorySection.tsx</files>
  <action>
Create a collapsible category section that groups triads by medical category.

Props interface:
```tsx
interface CategorySectionProps {
  category: TriadCategory;
  triads: Triad[];
}
```

Implementation:
1. Track `isExpanded` state (default false - collapsed initially per CONTEXT.md decision)
2. Header shows category name (capitalize first letter) and triad count
3. Header tap toggles expansion
4. When expanded, render TriadItem for each triad
5. Use same Reanimated accordion pattern as TriadItem for smooth animation
6. Show chevron icon in header that rotates on expand

Styling:
- Header: Typography.heading, colors.text, horizontal padding
- Background: colors.backgroundSecondary for header
- Count badge: Typography.footnote, colors.textSecondary
- Border radius on header

Category display names (capitalize):
- 'cardiology' -> 'Cardiology'
- Use simple string transform: category.charAt(0).toUpperCase() + category.slice(1)
  </action>
  <verify>Component renders category header and expands to show triads when tapped.</verify>
  <done>CategorySection shows category name with count, collapses/expands to show TriadItem list.</done>
</task>

<task type="auto">
  <name>Task 3: Wire Library screen</name>
  <files>medtriad/app/(tabs)/library.tsx</files>
  <action>
Replace placeholder Library screen with full implementation.

Implementation:
1. Import getAllTriads and getTriadsByCategory from @/services/triads
2. Import TriadCategory from @/types
3. Define CATEGORIES array with all 10 categories in display order:
   ['cardiology', 'neurology', 'endocrine', 'pulmonary', 'gastroenterology', 'infectious', 'hematology', 'rheumatology', 'renal', 'obstetrics']
4. Use ScrollView (not FlatList - small list, all rendered)
5. Map CATEGORIES to CategorySection components, passing category and filtered triads
6. Add screen title "Library" at top using Typography.title

Structure:
```tsx
<SafeAreaView>
  <ScrollView>
    <Text style={title}>Library</Text>
    {CATEGORIES.map(category => (
      <CategorySection
        key={category}
        category={category}
        triads={getTriadsByCategory(category)}
      />
    ))}
  </ScrollView>
</SafeAreaView>
```

Styling:
- Title: Typography.title, horizontal padding, top margin
- Content: bottom padding for scroll safety
  </action>
  <verify>
Run `npx expo start`, navigate to Library tab:
- Screen shows "Library" title
- 10 category sections appear
- Tapping category expands to show triads
- Tapping triad shows findings
- All 45 triads accessible
  </verify>
  <done>Library screen displays all triads grouped by category with expand/collapse functionality.</done>
</task>

</tasks>

<verification>
- [ ] Library tab shows all 10 medical categories
- [ ] Each category shows correct triad count
- [ ] Tapping category header expands/collapses smoothly
- [ ] Tapping triad expands to show all 3 findings
- [ ] Categories default to collapsed state
- [ ] Scrolling works smoothly through all categories
- [ ] No TypeScript errors (`npx tsc --noEmit`)
</verification>

<success_criteria>
Library screen enables study mode where users can:
- Browse all 45 triads organized by 10 medical categories
- Expand categories to see triads within
- Expand individual triads to see condition and all 3 findings
- Smooth animations on expand/collapse
</success_criteria>

<output>
After completion, create `.planning/phases/06-navigation-study-mode/06-02-SUMMARY.md`
</output>
